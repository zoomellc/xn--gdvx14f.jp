const CACHE_VERSION="2025-07-24-002",CACHE_NAME=`keigo-jp-v${CACHE_VERSION}`,FAVORITES_CACHE_NAME="keigo-jp-favorites",urlsToCache=["/","/css/style.css","/css/custom.css","/css/fonts.css","/css/blonde.min.css","/js/keyboard-navigation.js","/js/web-vitals.js","/js/favorites.js","/fonts/material-icons.woff","/favicon/favicon.ico"];async function cacheArticle(e){try{const t=await caches.open("keigo-jp-favorites"),a=await fetch(e);if(a.ok){await t.put(e,a.clone());const c=await a.text(),s=(new DOMParser).parseFromString(c,"text/html").querySelectorAll("img"),i=Array.from(s).map(async e=>{if(e.src&&e.src.startsWith("http"))try{const a=await fetch(e.src);a.ok&&await t.put(e.src,a)}catch(t){console.error("Failed to cache image:",e.src)}});await Promise.all(i),console.log("Article cached:",e)}}catch(e){console.error("Failed to cache article:",e)}}async function uncacheArticle(e){try{const t=await caches.open("keigo-jp-favorites");await t.delete(e)&&console.log("Article uncached:",e)}catch(e){console.error("Failed to uncache article:",e)}}self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE_NAME).then(e=>(console.log("Opened cache"),e.addAll(urlsToCache))))}),self.addEventListener("fetch",e=>{e.respondWith(caches.match(e.request).then(t=>t||caches.open("keigo-jp-favorites").then(t=>t.match(e.request)).then(t=>t||fetch(e.request).then(t=>{if(!t||200!==t.status||"basic"!==t.type)return t;const a=t.clone();return caches.open(CACHE_NAME).then(t=>{t.put(e.request,a)}),t}))))}),self.addEventListener("activate",e=>{const t=[CACHE_NAME,"keigo-jp-favorites"];e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(-1===t.indexOf(e))return caches.delete(e)}))))}),self.addEventListener("message",e=>{if(e.data)switch(e.data.type){case"SKIP_WAITING":self.skipWaiting();break;case"CACHE_ARTICLE":e.data.url&&cacheArticle(e.data.url);break;case"UNCACHE_ARTICLE":e.data.url&&uncacheArticle(e.data.url)}});