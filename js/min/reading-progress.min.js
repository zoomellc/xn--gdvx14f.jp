!function(){"use strict";const e={progressBar:null,article:null,initialized:!1,init(){this.isArticlePage()&&(this.article=document.querySelector(".content, article, main"),this.article&&(this.createProgressBar(),this.setupScrollListener(),this.initialized=!0))},isArticlePage(){const e=window.location.pathname;return!("/"===e||e.includes("/categories/")||e.includes("/tags/")||e.includes("/page/")||e.includes("/search/"))},createProgressBar(){const e=document.createElement("div");e.className="reading-progress-container",this.progressBar=document.createElement("div"),this.progressBar.className="reading-progress-bar",this.progressBar.setAttribute("role","progressbar"),this.progressBar.setAttribute("aria-label","読み進め状況"),this.progressBar.setAttribute("aria-valuemin","0"),this.progressBar.setAttribute("aria-valuemax","100"),this.progressBar.setAttribute("aria-valuenow","0"),e.appendChild(this.progressBar);const t=document.querySelector("header");t?t.appendChild(e):document.body.insertBefore(e,document.body.firstChild),this.addReadingTime()},setupScrollListener(){let e=!1;const t=()=>{const t=this.article.getBoundingClientRect(),i=t.top+window.pageYOffset,r=t.height,n=window.innerHeight,s=window.pageYOffset,a=i,o=i+r-n,c=Math.min(100,Math.max(0,(s-a)/(o-a)*100));this.progressBar.style.width=c+"%",this.progressBar.setAttribute("aria-valuenow",Math.round(c)),c>=98&&this.markAsRead(),e=!1};window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(t),e=!0)}),t()},addReadingTime(){const e=(this.article.innerText||this.article.textContent).length,t=Math.ceil(e/400),i=document.createElement("div");i.className="reading-time-indicator",i.innerHTML=`\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"></circle>\n          <polyline points="12 6 12 12 16 14"></polyline>\n        </svg>\n        <span>約${t}分で読めます</span>\n      `;const r=document.querySelector("h1.title, .content h1, article h1");r&&r.parentNode.insertBefore(i,r.nextSibling)},markAsRead(){const e=window.location.pathname,t=JSON.parse(localStorage.getItem("readArticles")||"[]");t.includes(e)||(t.push(e),localStorage.setItem("readArticles",JSON.stringify(t)),this.showReadNotification())},showReadNotification(){const e=document.createElement("div");e.className="read-notification",e.innerHTML='\n        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n          <polyline points="22 4 12 14.01 9 11.01"></polyline>\n        </svg>\n        <span>記事を読了しました！</span>\n      ',document.body.appendChild(e),setTimeout(()=>{e.classList.add("show")},100),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)},3e3)},markReadArticles(){if(this.isArticlePage())return;const e=JSON.parse(localStorage.getItem("readArticles")||"[]");document.querySelectorAll("a[href]").forEach(t=>{const i=t.getAttribute("href");if(e.includes(i)){t.classList.add("article-read");const e=document.createElement("span");e.className="read-badge",e.innerHTML="既読";const i=t.querySelector("h2, h3, .title");i&&!t.querySelector(".read-badge")&&i.appendChild(e)}})}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.init(),e.markReadArticles()}):(e.init(),e.markReadArticles());let t=window.location.pathname;new MutationObserver(()=>{window.location.pathname!==t&&(t=window.location.pathname,e.init(),e.markReadArticles())}).observe(document.body,{childList:!0,subtree:!0}),window.ReadingProgress=e}();