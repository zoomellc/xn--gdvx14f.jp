!function(){"use strict";class n{constructor(){this.comments=[],this.storageKey="keigo-jp-comments",this.articleId=this.getArticleId(),this.currentUser=this.loadUserData(),this.init()}getArticleId(){return window.location.pathname.replace(/\//g,"-").replace(/^-|-$/g,"")||"home"}loadUserData(){const n=localStorage.getItem("keigo-jp-user");if(n)try{return JSON.parse(n)}catch(n){return this.createNewUser()}return this.createNewUser()}createNewUser(){const n={id:this.generateId(),name:"",email:"",avatar:this.generateAvatar()};return localStorage.setItem("keigo-jp-user",JSON.stringify(n)),n}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}generateAvatar(){const n=["#667eea","#764ba2","#f093fb","#4facfe","#fa709a","#fed330"];return n[Math.floor(Math.random()*n.length)]}async init(){this.loadComments(),this.setupUI(),this.attachEventListeners(),this.renderComments()}loadComments(){const n=localStorage.getItem(this.storageKey);if(n)try{const t=JSON.parse(n);this.comments=t[this.articleId]||[]}catch(n){console.error("Failed to parse comments:",n),this.comments=[]}}saveComments(){const n=localStorage.getItem(this.storageKey);let t={};if(n)try{t=JSON.parse(n)}catch(n){console.error("Failed to parse existing comments:",n)}t[this.articleId]=this.comments,localStorage.setItem(this.storageKey,JSON.stringify(t))}setupUI(){this.injectStyles(),this.createCommentSection()}injectStyles(){const n=document.createElement("style");n.textContent="\n                .comment-section {\n                    margin: 40px 0;\n                    padding: 30px;\n                    background: var(--bg-color, #f8f9fa);\n                    border-radius: 12px;\n                }\n                \n                .comment-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 25px;\n                }\n                \n                .comment-title {\n                    font-size: 24px;\n                    font-weight: bold;\n                    color: var(--text-color, #333);\n                    margin: 0;\n                }\n                \n                .comment-count {\n                    color: var(--text-color-secondary, #666);\n                    font-size: 14px;\n                }\n                \n                .comment-form {\n                    background: var(--bg-color, white);\n                    padding: 20px;\n                    border-radius: 8px;\n                    margin-bottom: 30px;\n                    border: 1px solid rgba(0, 0, 0, 0.1);\n                }\n                \n                .comment-user-info {\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    gap: 15px;\n                    margin-bottom: 15px;\n                }\n                \n                .comment-input {\n                    width: 100%;\n                    padding: 10px 12px;\n                    border: 1px solid #e0e0e0;\n                    border-radius: 6px;\n                    font-size: 14px;\n                    font-family: inherit;\n                    transition: border-color 0.2s;\n                    background: var(--bg-color, white);\n                    color: var(--text-color, #333);\n                }\n                \n                .comment-input:focus {\n                    outline: none;\n                    border-color: #667eea;\n                }\n                \n                .comment-textarea {\n                    width: 100%;\n                    min-height: 100px;\n                    padding: 12px;\n                    border: 1px solid #e0e0e0;\n                    border-radius: 6px;\n                    font-size: 14px;\n                    resize: vertical;\n                    font-family: inherit;\n                    transition: border-color 0.2s;\n                    background: var(--bg-color, white);\n                    color: var(--text-color, #333);\n                    margin-bottom: 15px;\n                }\n                \n                .comment-textarea:focus {\n                    outline: none;\n                    border-color: #667eea;\n                }\n                \n                .comment-actions {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n                \n                .comment-guidelines {\n                    font-size: 12px;\n                    color: var(--text-color-secondary, #666);\n                }\n                \n                .comment-submit {\n                    background: #667eea;\n                    color: white;\n                    border: none;\n                    padding: 10px 24px;\n                    border-radius: 6px;\n                    font-size: 14px;\n                    font-weight: 500;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                }\n                \n                .comment-submit:hover {\n                    background: #5a67d8;\n                    transform: translateY(-1px);\n                }\n                \n                .comment-submit:disabled {\n                    background: #cbd5e0;\n                    cursor: not-allowed;\n                    transform: none;\n                }\n                \n                .comments-list {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 20px;\n                }\n                \n                .comment-item {\n                    background: var(--bg-color, white);\n                    padding: 20px;\n                    border-radius: 8px;\n                    border: 1px solid rgba(0, 0, 0, 0.1);\n                    transition: transform 0.2s;\n                }\n                \n                .comment-item:hover {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n                }\n                \n                .comment-meta {\n                    display: flex;\n                    align-items: center;\n                    gap: 12px;\n                    margin-bottom: 12px;\n                }\n                \n                .comment-avatar {\n                    width: 40px;\n                    height: 40px;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: white;\n                    font-weight: bold;\n                    font-size: 18px;\n                }\n                \n                .comment-author {\n                    font-weight: 500;\n                    color: var(--text-color, #333);\n                }\n                \n                .comment-date {\n                    font-size: 12px;\n                    color: var(--text-color-secondary, #666);\n                }\n                \n                .comment-content {\n                    color: var(--text-color, #333);\n                    line-height: 1.6;\n                    white-space: pre-wrap;\n                }\n                \n                .comment-footer {\n                    display: flex;\n                    gap: 15px;\n                    margin-top: 12px;\n                }\n                \n                .comment-action {\n                    font-size: 12px;\n                    color: var(--text-color-secondary, #666);\n                    cursor: pointer;\n                    transition: color 0.2s;\n                    display: flex;\n                    align-items: center;\n                    gap: 4px;\n                }\n                \n                .comment-action:hover {\n                    color: #667eea;\n                }\n                \n                .comment-action.liked {\n                    color: #ef4444;\n                }\n                \n                .comment-reply {\n                    margin-left: 50px;\n                    margin-top: 15px;\n                    padding: 15px;\n                    background: rgba(102, 126, 234, 0.05);\n                    border-radius: 6px;\n                    border-left: 3px solid #667eea;\n                }\n                \n                .comment-empty {\n                    text-align: center;\n                    padding: 40px;\n                    color: var(--text-color-secondary, #666);\n                }\n                \n                .comment-sort {\n                    display: flex;\n                    gap: 10px;\n                    margin-bottom: 20px;\n                }\n                \n                .comment-sort-btn {\n                    padding: 6px 12px;\n                    border: 1px solid #e0e0e0;\n                    border-radius: 4px;\n                    background: var(--bg-color, white);\n                    color: var(--text-color, #333);\n                    cursor: pointer;\n                    font-size: 12px;\n                    transition: all 0.2s;\n                }\n                \n                .comment-sort-btn:hover {\n                    border-color: #667eea;\n                    background: rgba(102, 126, 234, 0.05);\n                }\n                \n                .comment-sort-btn.active {\n                    background: #667eea;\n                    color: white;\n                    border-color: #667eea;\n                }\n                \n                @media (max-width: 768px) {\n                    .comment-section {\n                        padding: 20px;\n                    }\n                    \n                    .comment-user-info {\n                        grid-template-columns: 1fr;\n                    }\n                    \n                    .comment-reply {\n                        margin-left: 20px;\n                    }\n                }\n                \n                @media (prefers-color-scheme: dark) {\n                    .comment-section {\n                        background: #1e1e1e;\n                    }\n                    \n                    .comment-form,\n                    .comment-item {\n                        background: #2a2a2a;\n                        border-color: #444;\n                    }\n                    \n                    .comment-input,\n                    .comment-textarea {\n                        background: #333;\n                        border-color: #555;\n                        color: #e0e0e0;\n                    }\n                    \n                    .comment-input:focus,\n                    .comment-textarea:focus {\n                        border-color: #667eea;\n                    }\n                }\n            ",document.head.appendChild(n)}createCommentSection(){const n=document.querySelector(".comment-container");if(!n)return void console.warn("Comment container not found");const t=document.createElement("div");t.className="comment-section",t.innerHTML=`\n                <div class="comment-header">\n                    <h3 class="comment-title">コメント</h3>\n                    <span class="comment-count">0件のコメント</span>\n                </div>\n                \n                <div class="comment-form">\n                    <form id="comment-form">\n                        <div class="comment-user-info">\n                            <input \n                                type="text" \n                                class="comment-input" \n                                id="comment-name" \n                                placeholder="お名前（必須）" \n                                required\n                                value="${this.currentUser.name}"\n                            >\n                            <input \n                                type="email" \n                                class="comment-input" \n                                id="comment-email" \n                                placeholder="メールアドレス（任意）"\n                                value="${this.currentUser.email}"\n                            >\n                        </div>\n                        <textarea \n                            class="comment-textarea" \n                            id="comment-content" \n                            placeholder="コメントを入力してください..."\n                            required\n                        ></textarea>\n                        <div class="comment-actions">\n                            <span class="comment-guidelines">\n                                建設的で敬意のあるコメントをお願いします\n                            </span>\n                            <button type="submit" class="comment-submit" disabled>\n                                コメントを投稿\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                \n                <div class="comment-sort">\n                    <button class="comment-sort-btn active" data-sort="newest">新しい順</button>\n                    <button class="comment-sort-btn" data-sort="oldest">古い順</button>\n                    <button class="comment-sort-btn" data-sort="popular">人気順</button>\n                </div>\n                \n                <div class="comments-list" id="comments-list">\n                    <div class="comment-empty">\n                        まだコメントがありません。最初のコメントを投稿してみましょう！\n                    </div>\n                </div>\n            `,n.appendChild(t),this.form=t.querySelector("#comment-form"),this.nameInput=t.querySelector("#comment-name"),this.emailInput=t.querySelector("#comment-email"),this.contentInput=t.querySelector("#comment-content"),this.submitBtn=t.querySelector(".comment-submit"),this.commentsList=t.querySelector("#comments-list"),this.commentCount=t.querySelector(".comment-count"),this.sortButtons=t.querySelectorAll(".comment-sort-btn")}attachEventListeners(){this.form&&(this.nameInput.addEventListener("input",()=>this.validateForm()),this.contentInput.addEventListener("input",()=>this.validateForm()),this.nameInput.addEventListener("blur",()=>this.saveUserInfo()),this.emailInput.addEventListener("blur",()=>this.saveUserInfo()),this.form.addEventListener("submit",n=>{n.preventDefault(),this.submitComment()}),this.sortButtons.forEach(n=>{n.addEventListener("click",()=>{this.sortComments(n.dataset.sort),this.sortButtons.forEach(n=>n.classList.remove("active")),n.classList.add("active")})}))}validateForm(){const n=this.nameInput.value.trim()&&this.contentInput.value.trim();this.submitBtn.disabled=!n}saveUserInfo(){this.currentUser.name=this.nameInput.value.trim(),this.currentUser.email=this.emailInput.value.trim(),localStorage.setItem("keigo-jp-user",JSON.stringify(this.currentUser))}submitComment(){const n={id:this.generateId(),author:this.nameInput.value.trim(),email:this.emailInput.value.trim(),content:this.contentInput.value.trim(),timestamp:(new Date).toISOString(),likes:0,likedBy:[],replies:[],userId:this.currentUser.id,avatar:this.currentUser.avatar};this.comments.unshift(n),this.saveComments(),this.renderComments(),this.contentInput.value="",this.validateForm();const t=this.commentsList.querySelector(".comment-item");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}sortComments(n){switch(n){case"newest":this.comments.sort((n,t)=>new Date(t.timestamp)-new Date(n.timestamp));break;case"oldest":this.comments.sort((n,t)=>new Date(n.timestamp)-new Date(t.timestamp));break;case"popular":this.comments.sort((n,t)=>t.likes-n.likes)}this.renderComments()}renderComments(){this.commentCount.textContent=`${this.comments.length}件のコメント`,0!==this.comments.length?(this.commentsList.innerHTML=this.comments.map(n=>this.renderComment(n)).join(""),this.commentsList.querySelectorAll(".like-btn").forEach(n=>{n.addEventListener("click",()=>this.toggleLike(n.dataset.commentId))})):this.commentsList.innerHTML='\n                    <div class="comment-empty">\n                        まだコメントがありません。最初のコメントを投稿してみましょう！\n                    </div>\n                '}renderComment(n){const t=new Date(n.timestamp),e=this.formatDate(t),o=n.likedBy.includes(this.currentUser.id),r=n.author.charAt(0).toUpperCase();return`\n                <div class="comment-item" data-comment-id="${n.id}">\n                    <div class="comment-meta">\n                        <div class="comment-avatar" style="background: ${n.avatar}">\n                            ${r}\n                        </div>\n                        <div>\n                            <div class="comment-author">${this.escapeHtml(n.author)}</div>\n                            <div class="comment-date">${e}</div>\n                        </div>\n                    </div>\n                    <div class="comment-content">${this.escapeHtml(n.content)}</div>\n                    <div class="comment-footer">\n                        <span class="comment-action like-btn ${o?"liked":""}" data-comment-id="${n.id}">\n                            ${o?"❤️":"🤍"} ${n.likes}\n                        </span>\n                    </div>\n                </div>\n            `}toggleLike(n){const t=this.comments.find(t=>t.id===n);if(!t)return;const e=t.likedBy.indexOf(this.currentUser.id);e>-1?(t.likedBy.splice(e,1),t.likes--):(t.likedBy.push(this.currentUser.id),t.likes++),this.saveComments(),this.renderComments()}formatDate(n){const t=new Date-n,e=Math.floor(t/6e4),o=Math.floor(t/36e5),r=Math.floor(t/864e5);return e<1?"たった今":e<60?`${e}分前`:o<24?`${o}時間前`:r<7?`${r}日前`:n.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}escapeHtml(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new n}):new n}();