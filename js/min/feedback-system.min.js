!function(){"use strict";class e{constructor(){this.feedbackData=[],this.storageKey="keigo-jp-feedback",this.isOpen=!1,this.currentFeedback={rating:0,category:"",message:"",pageUrl:window.location.href,userAgent:navigator.userAgent,timestamp:null,sessionId:this.generateSessionId()},this.init()}generateSessionId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}async init(){this.loadFeedbackData(),this.setupUI(),this.attachEventListeners()}loadFeedbackData(){const e=localStorage.getItem(this.storageKey);if(e)try{this.feedbackData=JSON.parse(e)}catch(e){console.error("Failed to parse feedback data:",e),this.feedbackData=[]}}saveFeedbackData(){localStorage.setItem(this.storageKey,JSON.stringify(this.feedbackData))}setupUI(){this.injectStyles(),this.createFeedbackButton(),this.createFeedbackModal(),this.createThankYouMessage()}injectStyles(){const e=document.createElement("style");e.textContent="\n                .feedback-button {\n                    position: fixed;\n                    bottom: 20px;\n                    left: 20px;\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    color: white;\n                    border: none;\n                    border-radius: 30px;\n                    padding: 12px 24px;\n                    font-size: 14px;\n                    font-weight: 500;\n                    cursor: pointer;\n                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n                    transition: all 0.3s ease;\n                    z-index: 998;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n                \n                .feedback-button:hover {\n                    transform: translateY(-2px);\n                    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);\n                }\n                \n                .feedback-button-icon {\n                    font-size: 18px;\n                }\n                \n                .feedback-modal {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0, 0, 0, 0.5);\n                    display: none;\n                    z-index: 1000;\n                    padding: 20px;\n                    overflow-y: auto;\n                    backdrop-filter: blur(5px);\n                }\n                \n                .feedback-modal.show {\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                \n                .feedback-modal-content {\n                    background: var(--bg-color, white);\n                    max-width: 500px;\n                    width: 100%;\n                    padding: 30px;\n                    border-radius: 16px;\n                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n                    position: relative;\n                    animation: slideIn 0.3s ease;\n                }\n                \n                @keyframes slideIn {\n                    from {\n                        transform: translateY(20px);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translateY(0);\n                        opacity: 1;\n                    }\n                }\n                \n                .feedback-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 25px;\n                }\n                \n                .feedback-title {\n                    font-size: 24px;\n                    font-weight: bold;\n                    color: var(--text-color, #333);\n                    margin: 0;\n                }\n                \n                .feedback-close {\n                    background: none;\n                    border: none;\n                    font-size: 28px;\n                    cursor: pointer;\n                    color: var(--text-color-secondary, #999);\n                    padding: 0;\n                    width: 36px;\n                    height: 36px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    border-radius: 50%;\n                    transition: all 0.2s;\n                }\n                \n                .feedback-close:hover {\n                    background: rgba(0, 0, 0, 0.05);\n                    color: var(--text-color, #333);\n                }\n                \n                .feedback-form {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 20px;\n                }\n                \n                .feedback-section {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 8px;\n                }\n                \n                .feedback-label {\n                    font-weight: 500;\n                    color: var(--text-color, #333);\n                    font-size: 14px;\n                }\n                \n                .feedback-rating {\n                    display: flex;\n                    gap: 8px;\n                    font-size: 28px;\n                }\n                \n                .feedback-star {\n                    cursor: pointer;\n                    transition: all 0.2s;\n                    user-select: none;\n                }\n                \n                .feedback-star:hover {\n                    transform: scale(1.2);\n                }\n                \n                .feedback-star.active {\n                    color: #fbbf24;\n                }\n                \n                .feedback-star.inactive {\n                    color: #e0e0e0;\n                }\n                \n                .feedback-categories {\n                    display: grid;\n                    grid-template-columns: repeat(2, 1fr);\n                    gap: 10px;\n                }\n                \n                .feedback-category {\n                    padding: 12px;\n                    border: 2px solid #e0e0e0;\n                    border-radius: 8px;\n                    background: var(--bg-secondary, #f8f9fa);\n                    cursor: pointer;\n                    transition: all 0.2s;\n                    text-align: center;\n                    font-size: 14px;\n                    color: var(--text-color, #333);\n                }\n                \n                .feedback-category:hover {\n                    border-color: #667eea;\n                    background: rgba(102, 126, 234, 0.05);\n                }\n                \n                .feedback-category.selected {\n                    border-color: #667eea;\n                    background: #667eea;\n                    color: white;\n                }\n                \n                .feedback-textarea {\n                    width: 100%;\n                    min-height: 120px;\n                    padding: 12px;\n                    border: 2px solid #e0e0e0;\n                    border-radius: 8px;\n                    font-size: 14px;\n                    resize: vertical;\n                    font-family: inherit;\n                    transition: border-color 0.2s;\n                    background: var(--bg-color, white);\n                    color: var(--text-color, #333);\n                }\n                \n                .feedback-textarea:focus {\n                    outline: none;\n                    border-color: #667eea;\n                }\n                \n                .feedback-actions {\n                    display: flex;\n                    gap: 12px;\n                    justify-content: flex-end;\n                    margin-top: 10px;\n                }\n                \n                .feedback-btn {\n                    padding: 10px 20px;\n                    border: none;\n                    border-radius: 8px;\n                    font-size: 14px;\n                    font-weight: 500;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                }\n                \n                .feedback-btn-primary {\n                    background: #667eea;\n                    color: white;\n                }\n                \n                .feedback-btn-primary:hover {\n                    background: #5a67d8;\n                    transform: translateY(-1px);\n                }\n                \n                .feedback-btn-primary:disabled {\n                    background: #cbd5e0;\n                    cursor: not-allowed;\n                    transform: none;\n                }\n                \n                .feedback-btn-secondary {\n                    background: transparent;\n                    color: var(--text-color, #333);\n                    border: 2px solid #e0e0e0;\n                }\n                \n                .feedback-btn-secondary:hover {\n                    background: rgba(0, 0, 0, 0.05);\n                }\n                \n                .feedback-optional {\n                    display: flex;\n                    align-items: center;\n                    gap: 10px;\n                    font-size: 14px;\n                    color: var(--text-color-secondary, #666);\n                }\n                \n                .feedback-checkbox {\n                    width: 18px;\n                    height: 18px;\n                    cursor: pointer;\n                }\n                \n                .feedback-info {\n                    font-size: 12px;\n                    color: var(--text-color-secondary, #666);\n                    margin-top: 15px;\n                    padding: 12px;\n                    background: rgba(102, 126, 234, 0.05);\n                    border-radius: 6px;\n                    line-height: 1.5;\n                }\n                \n                .feedback-thankyou {\n                    position: fixed;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    background: var(--bg-color, white);\n                    padding: 40px;\n                    border-radius: 16px;\n                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n                    text-align: center;\n                    z-index: 1001;\n                    display: none;\n                    animation: fadeIn 0.3s ease;\n                }\n                \n                @keyframes fadeIn {\n                    from { opacity: 0; }\n                    to { opacity: 1; }\n                }\n                \n                .feedback-thankyou.show {\n                    display: block;\n                }\n                \n                .feedback-thankyou-icon {\n                    font-size: 48px;\n                    margin-bottom: 20px;\n                }\n                \n                .feedback-thankyou-title {\n                    font-size: 24px;\n                    font-weight: bold;\n                    color: var(--text-color, #333);\n                    margin-bottom: 10px;\n                }\n                \n                .feedback-thankyou-message {\n                    color: var(--text-color-secondary, #666);\n                    margin-bottom: 20px;\n                }\n                \n                .feedback-admin-button {\n                    position: fixed;\n                    bottom: 20px;\n                    right: 20px;\n                    background: #4b5563;\n                    color: white;\n                    border: none;\n                    border-radius: 50%;\n                    width: 48px;\n                    height: 48px;\n                    font-size: 20px;\n                    cursor: pointer;\n                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n                    transition: all 0.3s ease;\n                    z-index: 997;\n                }\n                \n                .feedback-admin-button:hover {\n                    transform: scale(1.1);\n                    background: #374151;\n                }\n                \n                @media (max-width: 768px) {\n                    .feedback-button {\n                        bottom: 80px;\n                        padding: 10px 20px;\n                        font-size: 13px;\n                    }\n                    \n                    .feedback-modal-content {\n                        padding: 20px;\n                        margin: 20px;\n                    }\n                    \n                    .feedback-categories {\n                        grid-template-columns: 1fr;\n                    }\n                    \n                    .feedback-title {\n                        font-size: 20px;\n                    }\n                }\n                \n                @media (prefers-color-scheme: dark) {\n                    .feedback-modal-content,\n                    .feedback-thankyou {\n                        background: #1e1e1e;\n                    }\n                    \n                    .feedback-textarea,\n                    .feedback-category {\n                        background: #2a2a2a;\n                        border-color: #444;\n                        color: #e0e0e0;\n                    }\n                    \n                    .feedback-category:hover {\n                        border-color: #667eea;\n                        background: rgba(102, 126, 234, 0.1);\n                    }\n                    \n                    .feedback-star.inactive {\n                        color: #555;\n                    }\n                }\n            ",document.head.appendChild(e)}createFeedbackButton(){const e=document.createElement("button");e.className="feedback-button",e.innerHTML='\n                <span class="feedback-button-icon">üí¨</span>\n                <span>„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ</span>\n            ',e.addEventListener("click",()=>this.openModal()),document.body.appendChild(e)}createFeedbackModal(){const e=document.createElement("div");e.className="feedback-modal",e.innerHTML=`\n                <div class="feedback-modal-content">\n                    <div class="feedback-header">\n                        <h2 class="feedback-title">„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Çí„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ</h2>\n                        <button class="feedback-close">&times;</button>\n                    </div>\n                    \n                    <form class="feedback-form">\n                        <div class="feedback-section">\n                            <label class="feedback-label">„Çµ„Ç§„Éà„ÅÆÊ∫ÄË∂≥Â∫¶„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</label>\n                            <div class="feedback-rating">\n                                ${[1,2,3,4,5].map(e=>`<span class="feedback-star inactive" data-rating="${e}">‚òÖ</span>`).join("")}\n                            </div>\n                        </div>\n                        \n                        <div class="feedback-section">\n                            <label class="feedback-label">„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅÆÁ®ÆÈ°û</label>\n                            <div class="feedback-categories">\n                                <div class="feedback-category" data-category="bug">\n                                    üêõ „Éê„Ç∞Â†±Âëä\n                                </div>\n                                <div class="feedback-category" data-category="feature">\n                                    üí° Ê©üËÉΩ„É™„ÇØ„Ç®„Çπ„Éà\n                                </div>\n                                <div class="feedback-category" data-category="content">\n                                    üìù „Ç≥„É≥„ÉÜ„É≥„ÉÑ\n                                </div>\n                                <div class="feedback-category" data-category="other">\n                                    üí≠ „Åù„ÅÆ‰ªñ\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="feedback-section">\n                            <label class="feedback-label">Ë©≥Á¥∞„Å™„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ</label>\n                            <textarea \n                                class="feedback-textarea" \n                                placeholder="„ÅîÊÑèË¶ã„Éª„ÅîË¶ÅÊúõ„Çí„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ..."\n                                maxlength="1000"\n                            ></textarea>\n                        </div>\n                        \n                        <div class="feedback-optional">\n                            <input type="checkbox" class="feedback-checkbox" id="include-page-info">\n                            <label for="include-page-info">ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏ÊÉÖÂ†±„ÇíÂê´„ÇÅ„Çã</label>\n                        </div>\n                        \n                        <div class="feedback-actions">\n                            <button type="button" class="feedback-btn feedback-btn-secondary cancel-btn">\n                                „Ç≠„É£„É≥„Çª„É´\n                            </button>\n                            <button type="submit" class="feedback-btn feedback-btn-primary submit-btn" disabled>\n                                ÈÄÅ‰ø°\n                            </button>\n                        </div>\n                        \n                        <div class="feedback-info">\n                            „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅØ„Éñ„É©„Ç¶„Ç∂„ÅÆ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇÂÄã‰∫∫ÊÉÖÂ†±„ÅØÂèéÈõÜ„Åï„Çå„Åæ„Åõ„Çì„ÄÇ\n                        </div>\n                    </form>\n                </div>\n            `,document.body.appendChild(e),this.modal=e,this.form=e.querySelector(".feedback-form"),this.ratingStars=e.querySelectorAll(".feedback-star"),this.categories=e.querySelectorAll(".feedback-category"),this.textarea=e.querySelector(".feedback-textarea"),this.submitBtn=e.querySelector(".submit-btn"),this.includePageInfo=e.querySelector("#include-page-info")}createThankYouMessage(){const e=document.createElement("div");e.className="feedback-thankyou",e.innerHTML='\n                <div class="feedback-thankyou-icon">üéâ</div>\n                <div class="feedback-thankyou-title">„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„ÅüÔºÅ</div>\n                <div class="feedback-thankyou-message">\n                    Ë≤¥Èáç„Å™„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Çí„ÅÑ„Åü„Å†„Åç„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ<br>\n                    „Çµ„Ç§„Éà„ÅÆÊîπÂñÑ„Å´Ê¥ªÁî®„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ\n                </div>\n                <button class="feedback-btn feedback-btn-primary close-thankyou">\n                    Èñâ„Åò„Çã\n                </button>\n            ',document.body.appendChild(e),this.thankyouMessage=e}attachEventListeners(){this.modal.querySelector(".feedback-close").addEventListener("click",()=>{this.closeModal()}),this.modal.querySelector(".cancel-btn").addEventListener("click",()=>{this.closeModal()}),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.closeModal()}),this.ratingStars.forEach((e,n)=>{e.addEventListener("click",()=>{this.selectRating(n+1)}),e.addEventListener("mouseenter",()=>{this.previewRating(n+1)})}),this.modal.querySelector(".feedback-rating").addEventListener("mouseleave",()=>{this.updateRatingDisplay(this.currentFeedback.rating)}),this.categories.forEach(e=>{e.addEventListener("click",()=>{this.selectCategory(e.dataset.category)})}),this.textarea.addEventListener("input",()=>{this.updateSubmitButton()}),this.form.addEventListener("submit",e=>{e.preventDefault(),this.submitFeedback()}),this.thankyouMessage.querySelector(".close-thankyou").addEventListener("click",()=>{this.thankyouMessage.classList.remove("show")}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.closeModal()}),document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&"F"===e.key&&(e.preventDefault(),this.showAdminPanel())})}selectRating(e){this.currentFeedback.rating=e,this.updateRatingDisplay(e),this.updateSubmitButton()}previewRating(e){this.updateRatingDisplay(e)}updateRatingDisplay(e){this.ratingStars.forEach((n,t)=>{t<e?(n.classList.add("active"),n.classList.remove("inactive")):(n.classList.remove("active"),n.classList.add("inactive"))})}selectCategory(e){this.currentFeedback.category=e,this.categories.forEach(n=>{n.dataset.category===e?n.classList.add("selected"):n.classList.remove("selected")}),this.updateSubmitButton()}updateSubmitButton(){const e=this.currentFeedback.rating>0&&this.currentFeedback.category&&this.textarea.value.trim().length>0;this.submitBtn.disabled=!e}openModal(){this.modal.classList.add("show"),this.isOpen=!0,document.body.style.overflow="hidden",this.resetForm()}closeModal(){this.modal.classList.remove("show"),this.isOpen=!1,document.body.style.overflow=""}resetForm(){this.currentFeedback={rating:0,category:"",message:"",pageUrl:window.location.href,userAgent:navigator.userAgent,timestamp:null,sessionId:this.generateSessionId()},this.updateRatingDisplay(0),this.categories.forEach(e=>e.classList.remove("selected")),this.textarea.value="",this.includePageInfo.checked=!0,this.submitBtn.disabled=!0}submitFeedback(){this.currentFeedback.message=this.textarea.value.trim(),this.currentFeedback.timestamp=(new Date).toISOString(),this.includePageInfo.checked||(delete this.currentFeedback.pageUrl,delete this.currentFeedback.userAgent),this.feedbackData.push({...this.currentFeedback}),this.saveFeedbackData(),this.closeModal(),this.showThankYou(),"undefined"!=typeof gtag&&gtag("event","feedback_submitted",{event_category:"engagement",event_label:this.currentFeedback.category,value:this.currentFeedback.rating})}showThankYou(){this.thankyouMessage.classList.add("show"),setTimeout(()=>{this.thankyouMessage.classList.remove("show")},3e3)}showAdminPanel(){const e=document.createElement("button");e.className="feedback-admin-button",e.innerHTML="üìä",e.title="„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÁÆ°ÁêÜ",e.addEventListener("click",()=>this.exportFeedback()),document.body.appendChild(e),setTimeout(()=>{e.remove()},1e4)}exportFeedback(){if(0===this.feedbackData.length)return void alert("„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");const e=JSON.stringify(this.feedbackData,null,2),n=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(n),a=document.createElement("a");a.href=t,a.download=`feedback-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new e}):new e}();