!function(){"use strict";const e={sessionId:null,startTime:Date.now(),metrics:{pageViews:0,interactions:0,errors:0,resourceTimings:[]},init:function(){this.sessionId=this.getOrCreateSessionId(),this.trackPageView(),this.setupEventListeners(),this.trackResourceTimings(),this.trackErrors(),this.trackUserEngagement()},getOrCreateSessionId:function(){let e=sessionStorage.getItem("rumSessionId");return e||(e=this.generateId(),sessionStorage.setItem("rumSessionId",e),sessionStorage.setItem("rumSessionStart",Date.now())),e},generateId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},trackPageView:function(){this.metrics.pageViews++;const e={url:window.location.href,title:document.title,referrer:document.referrer,timestamp:Date.now(),sessionId:this.sessionId,viewport:{width:window.innerWidth,height:window.innerHeight},screen:{width:window.screen.width,height:window.screen.height},connection:this.getConnectionInfo()};this.sendMetric("pageview",e)},getConnectionInfo:function(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?{type:e.effectiveType,downlink:e.downlink,rtt:e.rtt,saveData:e.saveData||!1}:null},setupEventListeners:function(){const self=this;document.addEventListener("click",function(e){self.trackInteraction("click",e.target)});let e,t=0;window.addEventListener("scroll",function(){clearTimeout(e),e=setTimeout(function(){const e=Math.round((window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100);e>t&&(t=e,self.sendMetric("scroll",{depth:t,url:window.location.href}))},100)}),document.addEventListener("visibilitychange",function(){self.sendMetric("visibility",{state:document.visibilityState,hiddenTime:document.hidden?Date.now():null})}),window.addEventListener("beforeunload",function(){self.sendMetric("session",{duration:Date.now()-self.startTime,pageViews:self.metrics.pageViews,interactions:self.metrics.interactions,errors:self.metrics.errors})})},trackInteraction:function(e,t){this.metrics.interactions++;const n={type:e,element:t.tagName,className:t.className,id:t.id,text:t.textContent?t.textContent.substring(0,50):"",timestamp:Date.now(),url:window.location.href};this.sendMetric("interaction",n)},trackResourceTimings:function(){const self=this;"PerformanceObserver"in window&&new PerformanceObserver(function(e){e.getEntries().forEach(function(e){if("resource"===e.entryType){const t={name:e.name,duration:Math.round(e.duration),size:e.transferSize||0,type:self.getResourceType(e.name),timestamp:Date.now()};self.metrics.resourceTimings.push(t),t.duration>1e3&&self.sendMetric("slow_resource",t)}})}).observe({entryTypes:["resource"]})},getResourceType:function(e){return{js:"script",css:"style",jpg:"image",jpeg:"image",png:"image",webp:"image",svg:"image",woff:"font",woff2:"font",ttf:"font"}[e.split(".").pop().split("?")[0].toLowerCase()]||"other"},trackErrors:function(){const self=this;window.addEventListener("error",function(e){self.metrics.errors++;const t={message:e.message,source:e.filename,line:e.lineno,column:e.colno,stack:e.error?e.error.stack:"",timestamp:Date.now(),url:window.location.href};self.sendMetric("error",t)}),window.addEventListener("unhandledrejection",function(e){self.metrics.errors++;const t={message:"Unhandled Promise Rejection",reason:e.reason,timestamp:Date.now(),url:window.location.href};self.sendMetric("error",t)})},trackUserEngagement:function(){const self=this;let e,t=0,n=Date.now(),i=!0;function o(){i&&(t+=Date.now()-n),n=Date.now()}function r(){clearTimeout(e),e=setTimeout(function(){i&&(o(),i=!1)},3e4)}["mousedown","keydown","scroll","touchstart"].forEach(function(e){document.addEventListener(e,function(){i||(i=!0,n=Date.now())})}),["mousedown","mousemove","keydown","scroll","touchstart"].forEach(function(e){document.addEventListener(e,r)}),setInterval(function(){o(),t>0&&self.sendMetric("engagement",{time:t,url:window.location.href})},6e4)},sendMetric:function(e,t){const n={type:e,data:t,sessionId:this.sessionId,timestamp:Date.now()};"localhost"===window.location.hostname&&console.log("RUM Metric:",n),window.gtag&&window.gtag("event","rum_"+e,{event_category:"RUM",event_label:JSON.stringify(t),value:t.value||0,non_interaction:!0}),this.storeMetric(n)},storeMetric:function(e){const t="rumMetrics";let n=JSON.parse(localStorage.getItem(t)||"[]");n.push(e),n.length>50&&(n=n.slice(-50));try{localStorage.setItem(t,JSON.stringify(n))}catch(e){console.warn("RUM storage quota exceeded")}},getMetrics:function(){return JSON.parse(localStorage.getItem("rumMetrics")||"[]")},clearMetrics:function(){localStorage.removeItem("rumMetrics")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.init()}):e.init(),window.RUM=e}();