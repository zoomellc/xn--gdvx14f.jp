!function(){"use strict";const e={config:{touchThreshold:10,swipeThreshold:50,doubleTapDelay:300,longPressDelay:500,viewportBreakpoint:768},state:{isTouch:!1,orientation:null,networkType:null,batteryLevel:null,reducedMotion:!1},init(){this.isMobile()&&(this.detectCapabilities(),this.setupViewportOptimizations(),this.enhanceTouchInteractions(),this.optimizePerformance(),this.setupOrientationHandling(),this.improveAccessibility(),this.setupNetworkAwareFeatures())},isMobile(){return window.innerWidth<this.config.viewportBreakpoint||"ontouchstart"in window||navigator.maxTouchPoints>0},detectCapabilities(){this.state.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0,this.state.reducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,"connection"in navigator&&(this.state.networkType=navigator.connection.effectiveType),"getBattery"in navigator&&navigator.getBattery().then(e=>{this.state.batteryLevel=e.level,e.addEventListener("levelchange",()=>{this.state.batteryLevel=e.level,this.adjustPerformanceSettings()})})},setupViewportOptimizations(){let e=0;document.addEventListener("touchend",t=>{const i=Date.now();i-e<=this.config.doubleTapDelay&&t.preventDefault(),e=i},{passive:!1}),this.fixViewportHeight(),window.addEventListener("resize",this.debounce(()=>this.fixViewportHeight(),100)),window.addEventListener("orientationchange",()=>this.fixViewportHeight())},fixViewportHeight(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),window.innerHeight<500?document.body.classList.add("short-viewport"):document.body.classList.remove("short-viewport")},enhanceTouchInteractions(){document.addEventListener("touchstart",e=>{const t=e.target.closest("a, button, .touchable");t&&(t.classList.add("touch-active"),"vibrate"in navigator&&!this.state.reducedMotion&&navigator.vibrate(10))},{passive:!0}),document.addEventListener("touchend",e=>{const t=e.target.closest("a, button, .touchable");t&&setTimeout(()=>{t.classList.remove("touch-active")},100)},{passive:!0}),this.setupPullToRefresh(),this.setupSwipeNavigation()},setupPullToRefresh(){let e=0,t=0,i=!1;const n=document.createElement("div");n.className="pull-to-refresh",n.innerHTML='\n        <div class="pull-to-refresh-icon">\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n            <path d="M21 12a9 9 0 11-6.219-8.56" stroke-width="2" stroke-linecap="round"/>\n            <polyline points="21 4 21 12 13 12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>\n        </div>\n      ',document.body.prepend(n),document.addEventListener("touchstart",t=>{0===window.scrollY&&(e=t.touches[0].pageY,i=!0)},{passive:!0}),document.addEventListener("touchmove",s=>{if(!i)return;t=s.touches[0].pageY;const o=t-e;if(o>0&&0===window.scrollY){s.preventDefault();const e=Math.min(o/80,1),t=.5+.5*e;n.style.opacity=e,n.style.transform=`translateY(${Math.min(.5*o,50)}px) scale(${t})`,o>80?n.classList.add("ready"):n.classList.remove("ready")}},{passive:!1}),document.addEventListener("touchend",()=>{i&&t-e>80?(n.classList.add("refreshing"),setTimeout(()=>{window.location.reload()},500)):(n.style.opacity="0",n.style.transform="translateY(0) scale(0.5)",n.classList.remove("ready")),i=!1},{passive:!0})},setupSwipeNavigation(){let e=0,t=0;document.addEventListener("touchstart",i=>{e=i.touches[0].clientX,t=i.touches[0].clientY},{passive:!0}),document.addEventListener("touchend",i=>{const n=i.changedTouches[0].clientX,s=i.changedTouches[0].clientY,o=n-e,a=s-t;Math.abs(o)>Math.abs(a)&&Math.abs(o)>this.config.swipeThreshold&&(o>0&&e<20?window.history.length>1&&window.history.back():o<0&&e>window.innerWidth-20&&window.history.forward())},{passive:!0})},optimizePerformance(){this.setupLazyLoading(),this.optimizeScrollEvents(),this.adjustPerformanceSettings(),this.preloadCriticalResources()},setupLazyLoading(){const e=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const i=e.target;i.src=i.dataset.src,i.classList.add("lazy-loaded"),t.unobserve(i)}})},{rootMargin:"50px 0px",threshold:.01});e.forEach(e=>t.observe(e))}else e.forEach(e=>{e.src=e.dataset.src})},optimizeScrollEvents(){let e,t=!1;window.addEventListener("scroll",()=>{t||(document.body.classList.add("is-scrolling"),t=!0),clearTimeout(e),e=setTimeout(()=>{document.body.classList.remove("is-scrolling"),t=!1},150)},{passive:!0})},adjustPerformanceSettings(){const e=this.state.batteryLevel<.2,t="2g"===this.state.networkType||"slow-2g"===this.state.networkType;e||t||this.state.reducedMotion?(document.body.classList.add("reduce-animations"),window.MobileGestures&&window.MobileGestures.disable()):document.body.classList.remove("reduce-animations")},preloadCriticalResources(){document.querySelectorAll('a[href^="/"]').forEach(e=>{e.addEventListener("touchstart",()=>{const t=e.getAttribute("href");if(t&&!document.querySelector(`link[rel="prefetch"][href="${t}"]`)){const e=document.createElement("link");e.rel="prefetch",e.href=t,document.head.appendChild(e)}},{passive:!0})})},setupOrientationHandling(){const e=()=>{const e=window.innerWidth>window.innerHeight?"landscape":"portrait";this.state.orientation=e,document.body.setAttribute("data-orientation",e),"landscape"===e&&window.innerHeight<500?document.body.classList.add("landscape-compact"):document.body.classList.remove("landscape-compact")};e(),window.addEventListener("orientationchange",e),window.addEventListener("resize",this.debounce(e,100))},improveAccessibility(){this.state.isTouch&&document.body.classList.add("touch-mode"),document.addEventListener("touchstart",()=>{document.body.classList.add("touch-input")},{once:!0}),document.addEventListener("keydown",()=>{document.body.classList.remove("touch-input")}),this.addMobileSkipLinks()},addMobileSkipLinks(){const e=document.createElement("div");e.className="mobile-skip-links",e.innerHTML='\n        <a href="#main-content" class="skip-link">メインコンテンツへ</a>\n        <a href="#mobile-nav" class="skip-link">ナビゲーションへ</a>\n      ',document.body.prepend(e)},setupNetworkAwareFeatures(){"connection"in navigator&&navigator.connection.addEventListener("change",()=>{this.state.networkType=navigator.connection.effectiveType,this.adjustPerformanceSettings(),"offline"===this.state.networkType&&this.showToast("オフラインです","warning")}),window.addEventListener("online",()=>{this.showToast("オンラインに戻りました","success")}),window.addEventListener("offline",()=>{this.showToast("オフラインになりました","warning")})},showToast(e,t="info"){const i=document.createElement("div");i.className=`mobile-toast mobile-toast-${t}`,i.textContent=e,i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),document.body.appendChild(i),requestAnimationFrame(()=>{i.classList.add("show")}),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{document.body.removeChild(i)},300)},3e3)},debounce(e,t){let i;return function(...n){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...n)},t)}}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init(),window.MobileEnhancements=e}();