# Google Analytics 4 (GA4) セットアップガイド

このガイドでは、敬語.jpサイトにGoogle Analytics 4を設定する方法を説明します。

## 1. GA4プロパティの作成

1. [Google Analytics](https://analytics.google.com/)にアクセス
2. 管理 → プロパティを作成
3. プロパティ名を入力（例：敬語.jp）
4. タイムゾーンと通貨を設定
5. ビジネス情報を入力
6. データストリームを作成（ウェブを選択）
7. ウェブサイトのURLとストリーム名を入力

## 2. 測定IDの取得

データストリームの詳細ページで「測定ID」（G-XXXXXXXXXX形式）をコピー

## 3. config.tomlの設定

`config.toml`に以下の設定を追加：

```toml
[params.googleAnalytics4]
  measurementId = "G-XXXXXXXXXX"  # あなたの測定IDに置き換え
  
  # オプション設定
  debug = false                   # デバッグモード（開発時はtrue）
  anonymizeIp = true             # IPアドレスの匿名化
  linkAttribution = true         # 拡張リンクアトリビューション
  cookieDomain = "xn--gdvx14f.jp" # クッキードメイン
  cookieFlags = "SameSite=None;Secure" # クッキーフラグ
  
  # 高度な機能
  enhancedEcommerce = false      # Enhanced Ecommerce（将来用）
  consentMode = false            # Google Consent Mode v2
```

## 4. analytics部分テンプレートの更新

`layouts/partials/head.html`の2行目を以下に変更：

```html
{{- partial "analytics-ga4" . -}}
```

## 5. 機能の活用

### 自動追跡される項目

- ページビュー（記事のメタデータ付き）
- スクロール深度（25%, 50%, 75%, 100%）
- 滞在時間（15秒, 30秒, 60秒, 180秒）
- 外部リンククリック
- サイト内検索
- エラー発生
- ページ読み込みパフォーマンス

### カスタムイベントの送信

JavaScriptから以下の関数を使用：

```javascript
// カスタムイベント
window.trackCustomEvent('button_click', {
  event_category: 'engagement',
  event_label: 'header_cta',
  value: 1
});

// ユーザープロパティ
window.setUserProperty({
  user_level: 'intermediate',
  subscription_status: 'free'
});
```

## 6. GA4での確認事項

### 必須の設定

1. **データ保持期間**
   - 管理 → データ設定 → データ保持
   - イベントデータの保持を「14か月」に設定

2. **Google シグナル**
   - 管理 → データ設定 → データ収集
   - Google シグナルを有効化

3. **拡張計測機能**
   - データストリーム → 拡張計測機能
   - すべての項目を有効化

### 推奨カスタムディメンション

以下のカスタムディメンションを作成することを推奨：

1. author（記事の著者）
2. publish_date（公開日）
3. word_count（文字数）
4. reading_time（読了時間）
5. tags（タグ）
6. content_group（カテゴリー）

### カスタムディメンションの作成方法

1. GA4管理画面 → カスタム定義 → カスタムディメンション
2. 「カスタムディメンションを作成」をクリック
3. 以下の情報を入力：
   - ディメンション名：わかりやすい名前
   - 範囲：イベント
   - イベントパラメータ：上記のパラメータ名

## 7. レポートの活用

### 基本レポート

- **エンゲージメント** → **ページとスクリーン**：人気記事の確認
- **ユーザー** → **ユーザー属性**：読者層の分析
- **集客** → **トラフィック獲得**：流入元の分析

### カスタムレポート例

1. **記事パフォーマンスレポート**
   - ディメンション：ページタイトル、カテゴリー
   - 指標：表示回数、エンゲージメント率、平均エンゲージメント時間

2. **著者別パフォーマンス**
   - ディメンション：author（カスタム）
   - 指標：表示回数、ユーザー数、エンゲージメント率

3. **読了率分析**
   - ディメンション：ページタイトル
   - 指標：scroll_depth別のイベント数

## 8. プライバシーポリシーの更新

GA4を使用する場合、プライバシーポリシーに以下を記載：

- Google Analyticsの使用
- 収集するデータの種類
- データの利用目的
- クッキーの使用
- オプトアウトの方法

## 9. トラブルシューティング

### データが表示されない場合

1. リアルタイムレポートで確認
2. デバッグモードを有効化（config.tomlで`debug = true`）
3. ブラウザの開発者ツールでエラーを確認
4. 広告ブロッカーを無効化してテスト

### よくある問題

- **測定IDの形式**：必ず「G-」で始まる形式を使用
- **二重計測**：古いanalytics.htmlが残っていないか確認
- **フィルタ**：内部トラフィックフィルタの設定を確認

## 10. 次のステップ

1. **目標の設定**：重要なコンバージョンイベントを設定
2. **オーディエンスの作成**：再訪問者、高エンゲージメントユーザーなど
3. **探索レポート**：より詳細な分析のためのカスタムレポート作成
4. **BigQueryとの連携**：大規模データ分析（任意）

---

設定に関する質問は、お問い合わせページからご連絡ください。