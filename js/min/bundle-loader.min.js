var __awaiter=this&&this.__awaiter||function(e,n,t,s){return new(t||(t=Promise))(function(i,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(r,d)}a((s=s.apply(e,n||[])).next())})};class BundleLoader{constructor(){this.observer=null,this.loadedBundles=new Set,this.bundles={interactive:{triggers:["honorific-converter","honorific-examples","honorific-quiz"],scripts:["/js/min/honorific-converter.min.js","/js/min/honorific-examples.min.js","/js/min/honorific-quiz-enhanced.min.js"],preload:!1},utilities:{triggers:["search-form","favorites-button","font-size-controls","share-buttons","popular-posts-widget"],scripts:["/js/min/search.min.js","/js/min/favorites.min.js","/js/min/font-size-adjuster.min.js","/js/min/share-buttons.min.js","/js/min/popular-posts.min.js"],preload:!1},mobile:{condition:()=>window.innerWidth<=768,scripts:["/js/min/mobile-gestures.min.js","/js/min/mobile-bottom-nav.min.js","/js/min/mobile-enhancements.min.js"],preload:!0},core:{autoload:!0,scripts:["/js/min/dark-mode.min.js","/js/min/lazy-load.min.js","/js/min/table-responsive.min.js"]},feedback:{triggers:["feedback-button","feedback-system"],scripts:["/js/min/feedback-system.min.js"],preload:!1},dictionary:{triggers:["honorific-dictionary-container"],scripts:["/js/min/honorific-dictionary.min.js"],preload:!1},comments:{triggers:["comment-container","comment-section"],scripts:["/js/min/comment-system.min.js"],preload:!1},profile:{triggers:["user-profile-trigger"],scripts:["/js/min/user-profile.min.js"],preload:!1,autoload:!0},heatmap:{scripts:["/js/min/heatmap-tracker.min.js"],preload:!1,autoload:!0}}}init(){this.loadAutoloadBundles(),this.setupObservers(),this.checkConditionalBundles(),this.setupPreloading()}loadAutoloadBundles(){Object.entries(this.bundles).forEach(([e,n])=>{n.autoload&&this.loadBundle(e)})}setupObservers(){"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{var n;if(e.isIntersecting){const t=e.target,s=this.findBundleByTrigger(t);s&&!this.loadedBundles.has(s)&&(this.loadBundle(s),null===(n=this.observer)||void 0===n||n.unobserve(t))}})},{rootMargin:"50px"}),Object.entries(this.bundles).forEach(([,e])=>{e.triggers&&e.triggers.forEach(e=>{document.querySelectorAll(`[data-bundle="${e}"], .${e}, #${e}`).forEach(e=>{var n;return null===(n=this.observer)||void 0===n?void 0:n.observe(e)})})}))}findBundleByTrigger(e){for(const[n,t]of Object.entries(this.bundles))if(t.triggers)for(const s of t.triggers)if(e.matches(`[data-bundle="${s}"], .${s}, #${s}`))return n;return null}checkConditionalBundles(){Object.entries(this.bundles).forEach(([e,n])=>{n.condition&&n.condition()&&(n.preload?this.preloadBundle(e):this.loadBundle(e))})}setupPreloading(){Object.entries(this.bundles).forEach(([e,n])=>{!n.preload||n.condition||n.autoload||this.preloadBundle(e)})}preloadBundle(e){const n=this.bundles[e];n&&(n.scripts||(n.path?[n.path]:[])).forEach(e=>{const n=document.createElement("link");n.rel="preload",n.as="script",n.href=e,document.head.appendChild(n)})}loadBundle(e){return __awaiter(this,void 0,void 0,function*(){if(this.loadedBundles.has(e))return;const n=this.bundles[e];if(n)try{this.loadedBundles.add(e);const t=n.scripts||(n.path?[n.path]:[]);let s=0;const i=n=>new Promise((i,o)=>{const r=document.createElement("script");r.src=n,r.async=!0,r.onload=()=>{if(s++,s===t.length){const n=new CustomEvent("bundleLoaded",{detail:{bundleName:e}});document.dispatchEvent(n)}i()},r.onerror=()=>{console.error(`Failed to load script: ${n}`),o(new Error(`Failed to load script: ${n}`))},document.body.appendChild(r)});for(const e of t)yield i(e)}catch(n){this.loadedBundles.delete(e),console.error(`Error loading bundle ${e}:`,n)}})}load(e){return this.loadBundle(e)}destroy(){var e;null===(e=this.observer)||void 0===e||e.disconnect(),this.observer=null}}const bundleLoaderInstance=new BundleLoader;window.bundleLoader=bundleLoaderInstance,window.BundleLoader=bundleLoaderInstance,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>bundleLoaderInstance.init()):bundleLoaderInstance.init();export default bundleLoaderInstance;export{BundleLoader};