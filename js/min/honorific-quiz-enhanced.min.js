!function(){"use strict";class t{constructor(){this.quizData=null,this.currentLevel="beginner",this.currentQuiz=null,this.currentQuestionIndex=0,this.score=0,this.totalQuestions=0,this.answeredQuestions=[],this.wrongAnswers=[],this.reviewMode=!1,this.storageKey="honorificQuizData",this.init()}async init(){try{await this.loadQuizData(),this.loadProgress(),this.setupEventListeners(),this.renderLevelSelector()}catch(t){console.error("Failed to initialize quiz:",t)}}async loadQuizData(){try{const t=await fetch("/data/honorific-quiz-data.json"),e=await t.json();this.quizData=e.quizData}catch(t){console.error("Failed to load quiz data:",t),this.quizData={beginner:[],intermediate:[],advanced:[]}}}loadProgress(){const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);this.score=e.score||0,this.totalQuestions=e.totalQuestions||0,this.wrongAnswers=e.wrongAnswers||[],this.updateProgressDisplay()}}saveProgress(){const t={score:this.score,totalQuestions:this.totalQuestions,wrongAnswers:this.wrongAnswers,lastUpdated:(new Date).toISOString()};localStorage.setItem(this.storageKey,JSON.stringify(t))}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches(".level-selector button")?this.selectLevel(t.target.dataset.level):t.target.matches(".start-quiz-btn")?this.startQuiz():t.target.matches(".review-mistakes-btn")?this.startReviewMode():t.target.matches(".next-question-btn")?this.nextQuestion():t.target.matches(".finish-quiz-btn")&&this.finishQuiz()})}renderLevelSelector(){document.querySelectorAll(".honorific-quiz-enhanced").forEach(t=>{t.innerHTML=`\n                    <div class="quiz-header mb-6">\n                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">敬語クイズ - レベル選択</h3>\n                        \n                        <div class="level-selector flex gap-4 mb-6">\n                            <button data-level="beginner" class="level-btn px-6 py-3 rounded-lg border-2 transition-all duration-200 ${"beginner"===this.currentLevel?"bg-blue-500 text-white border-blue-500":"border-gray-300 dark:border-gray-600 hover:border-blue-400"}">\n                                初級\n                            </button>\n                            <button data-level="intermediate" class="level-btn px-6 py-3 rounded-lg border-2 transition-all duration-200 ${"intermediate"===this.currentLevel?"bg-blue-500 text-white border-blue-500":"border-gray-300 dark:border-gray-600 hover:border-blue-400"}">\n                                中級\n                            </button>\n                            <button data-level="advanced" class="level-btn px-6 py-3 rounded-lg border-2 transition-all duration-200 ${"advanced"===this.currentLevel?"bg-blue-500 text-white border-blue-500":"border-gray-300 dark:border-gray-600 hover:border-blue-400"}">\n                                上級\n                            </button>\n                        </div>\n                        \n                        <div class="quiz-stats bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">\n                            <div class="flex justify-between items-center">\n                                <div>\n                                    <p class="text-sm text-gray-600 dark:text-gray-400">総合スコア</p>\n                                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-200">\n                                        <span class="score-display">${this.score}</span> / <span class="total-display">${this.totalQuestions}</span>\n                                    </p>\n                                </div>\n                                <div>\n                                    <p class="text-sm text-gray-600 dark:text-gray-400">正答率</p>\n                                    <p class="text-2xl font-bold text-gray-800 dark:text-gray-200">\n                                        <span class="accuracy-display">${this.totalQuestions>0?Math.round(this.score/this.totalQuestions*100):0}</span>%\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="action-buttons flex gap-4">\n                            <button class="start-quiz-btn px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors duration-200">\n                                クイズを開始\n                            </button>\n                            ${this.wrongAnswers.length>0?`\n                                <button class="review-mistakes-btn px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-medium transition-colors duration-200">\n                                    間違えた問題を復習 (${this.wrongAnswers.length}問)\n                                </button>\n                            `:""}\n                        </div>\n                    </div>\n                    \n                    <div class="quiz-content-area"></div>\n                `})}selectLevel(t){this.currentLevel=t,this.renderLevelSelector()}startQuiz(){this.reviewMode=!1,this.currentQuiz=[...this.quizData[this.currentLevel]],this.shuffleArray(this.currentQuiz),this.currentQuestionIndex=0,this.answeredQuestions=[],this.renderQuestion()}startReviewMode(){this.reviewMode=!0,this.currentQuiz=this.wrongAnswers.map(t=>{for(const e of Object.keys(this.quizData)){const n=this.quizData[e].find(e=>e.id===t);if(n)return n}}).filter(Boolean),0!==this.currentQuiz.length?(this.currentQuestionIndex=0,this.answeredQuestions=[],this.renderQuestion()):alert("復習する問題がありません。")}renderQuestion(){const t=this.currentQuiz[this.currentQuestionIndex];document.querySelector(".quiz-content-area").innerHTML=`\n                <div class="question-container">\n                    <div class="question-header mb-4">\n                        <div class="flex justify-between items-center mb-2">\n                            <span class="text-sm text-gray-600 dark:text-gray-400">\n                                問題 ${this.currentQuestionIndex+1} / ${this.currentQuiz.length}\n                            </span>\n                            ${this.reviewMode?'<span class="text-sm text-orange-600 dark:text-orange-400 font-bold">復習モード</span>':""}\n                        </div>\n                        <div class="progress-bar w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">\n                            <div class="progress-fill h-full bg-gradient-to-r from-purple-400 to-pink-500 rounded-full transition-all duration-500" \n                                 style="width: ${(this.currentQuestionIndex+1)/this.currentQuiz.length*100}%"></div>\n                        </div>\n                    </div>\n                    \n                    <div class="question-section mb-6">\n                        <p class="text-lg text-gray-700 dark:text-gray-300 font-medium mb-4">\n                            ${t.question}\n                        </p>\n                        \n                        ${t.sentence?`\n                            <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">\n                                <p class="text-gray-800 dark:text-gray-200 font-mono">\n                                    「${t.sentence}」\n                                </p>\n                            </div>\n                        `:""}\n                        \n                        ${t.category?`\n                            <span class="inline-block px-3 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">\n                                ${t.category}\n                            </span>\n                        `:""}\n                    </div>\n                    \n                    <div class="options-section space-y-3" data-question-id="${t.id}">\n                        ${t.options.map((t,e)=>`\n                            <button class="quiz-option w-full text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200"\n                                    data-correct="${t.correct}"\n                                    data-explanation="${t.explanation||""}"\n                                    data-index="${e}">\n                                <div class="flex items-center">\n                                    <span class="option-indicator w-8 h-8 rounded-full border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center mr-3 text-sm font-bold">\n                                        ${e+1}\n                                    </span>\n                                    <span class="option-text text-gray-700 dark:text-gray-300">\n                                        ${t.text}\n                                    </span>\n                                </div>\n                            </button>\n                        `).join("")}\n                    </div>\n                    \n                    <div class="result-section hidden mt-6">\n                        <div class="result-message p-4 rounded-lg mb-4">\n                            <p class="text-lg font-bold mb-2"></p>\n                            <p class="text-sm"></p>\n                        </div>\n                        \n                        ${t.explanation?`\n                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4">\n                                <h4 class="font-bold text-blue-700 dark:text-blue-300 mb-2">解説</h4>\n                                <p class="text-sm text-blue-600 dark:text-blue-400">\n                                    ${t.explanation}\n                                </p>\n                            </div>\n                        `:""}\n                        \n                        <div class="action-buttons">\n                            ${this.currentQuestionIndex<this.currentQuiz.length-1?'\n                                <button class="next-question-btn px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors duration-200">\n                                    次の問題へ\n                                </button>\n                            ':'\n                                <button class="finish-quiz-btn px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors duration-200">\n                                    クイズを終了\n                                </button>\n                            '}\n                        </div>\n                    </div>\n                </div>\n            `,this.attachQuestionListeners()}attachQuestionListeners(){const t=document.querySelectorAll(".quiz-option");let e=!1;t.forEach(n=>{n.addEventListener("click",()=>{if(e)return;e=!0;const s=n.closest(".options-section").dataset.questionId,r="true"===n.dataset.correct,i=n.dataset.explanation;this.handleAnswer(s,r),t.forEach(t=>{const e=t.querySelector(".option-indicator");"true"===t.dataset.correct?(t.classList.add("border-green-500","dark:border-green-400","bg-green-50","dark:bg-green-900/20"),e.classList.add("bg-green-500","text-white"),e.innerHTML="✓"):t!==n||r||(t.classList.add("border-red-500","dark:border-red-400","bg-red-50","dark:bg-red-900/20"),e.classList.add("bg-red-500","text-white"),e.innerHTML="✗"),t.disabled=!0}),setTimeout(()=>{const t=document.querySelector(".result-section"),e=t.querySelector(".result-message p:first-child"),n=t.querySelector(".result-message p:last-child");t.classList.remove("hidden"),r?(e.textContent="正解です！",e.className="text-lg font-bold mb-2 text-green-600 dark:text-green-400",n.textContent=i||"よく理解できています。"):(e.textContent="惜しい！",e.className="text-lg font-bold mb-2 text-red-600 dark:text-red-400",n.textContent=i||"もう一度考えてみましょう。")},500)})})}handleAnswer(t,e){if(this.answeredQuestions.push({id:t,correct:e}),this.reviewMode){if(e){const e=this.wrongAnswers.indexOf(t);e>-1&&this.wrongAnswers.splice(e,1)}}else if(this.totalQuestions++,e){this.score++;const e=this.wrongAnswers.indexOf(t);e>-1&&this.wrongAnswers.splice(e,1)}else this.wrongAnswers.includes(t)||this.wrongAnswers.push(t);this.saveProgress(),this.updateProgressDisplay()}nextQuestion(){this.currentQuestionIndex++,this.renderQuestion()}finishQuiz(){const t=this.answeredQuestions.filter(t=>t.correct).length,e=this.answeredQuestions.length,n=Math.round(t/e*100);document.querySelector(".quiz-content-area").innerHTML=`\n                <div class="quiz-results text-center">\n                    <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6">\n                        ${this.reviewMode?"復習":"クイズ"}結果\n                    </h3>\n                    \n                    <div class="result-stats bg-gray-100 dark:bg-gray-800 rounded-lg p-6 mb-6">\n                        <div class="grid grid-cols-3 gap-4">\n                            <div>\n                                <p class="text-sm text-gray-600 dark:text-gray-400">正解数</p>\n                                <p class="text-3xl font-bold text-green-600 dark:text-green-400">${t}</p>\n                            </div>\n                            <div>\n                                <p class="text-sm text-gray-600 dark:text-gray-400">問題数</p>\n                                <p class="text-3xl font-bold text-gray-800 dark:text-gray-200">${e}</p>\n                            </div>\n                            <div>\n                                <p class="text-sm text-gray-600 dark:text-gray-400">正答率</p>\n                                <p class="text-3xl font-bold ${n>=80?"text-green-600 dark:text-green-400":n>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}">${n}%</p>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="result-message mb-6">\n                        <p class="text-lg text-gray-700 dark:text-gray-300">\n                            ${n>=80?"素晴らしい成績です！敬語をよく理解されています。":n>=60?"よく頑張りました！もう少しで完璧です。":"復習して、もう一度挑戦してみましょう！"}\n                        </p>\n                    </div>\n                    \n                    <button class="back-to-menu-btn px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors duration-200"\n                            onclick="location.reload()">\n                        メニューに戻る\n                    </button>\n                </div>\n            `}updateProgressDisplay(){const t=document.querySelectorAll(".score-display"),e=document.querySelectorAll(".total-display"),n=document.querySelectorAll(".accuracy-display");t.forEach(t=>t.textContent=this.score),e.forEach(t=>t.textContent=this.totalQuestions),n.forEach(t=>{t.textContent=this.totalQuestions>0?Math.round(this.score/this.totalQuestions*100):0})}shuffleArray(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".honorific-quiz-enhanced")&&new t})}();