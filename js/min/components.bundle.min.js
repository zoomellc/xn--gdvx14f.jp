(()=>{"use strict";class t{constructor(t={}){this.prefix=t.prefix||"keigo_",this.defaultTTL=t.ttl}getKey(t){return`${this.prefix}${t}`}set(t,e,i){try{const n={value:e,timestamp:Date.now()};return(i||this.defaultTTL)&&(n.expires=Date.now()+(i||this.defaultTTL)),localStorage.setItem(this.getKey(t),JSON.stringify(n)),!0}catch(t){return!1}}get(t){try{const e=localStorage.getItem(this.getKey(t));if(!e)return null;const i=JSON.parse(e);return i.expires&&i.expires<Date.now()?(this.remove(t),null):i.value}catch(t){return null}}remove(t){try{return localStorage.removeItem(this.getKey(t)),!0}catch(t){return!1}}clear(t){try{const e=Object.keys(localStorage),i=this.getKey(t||"");return e.forEach(t=>{t.startsWith(i)&&localStorage.removeItem(t)}),!0}catch(t){return!1}}has(t){return null!==this.get(t)}getAll(t){const e={},i=Object.keys(localStorage),n=this.getKey(t||"");return i.forEach(t=>{if(t.startsWith(n)){const i=t.replace(this.prefix,""),n=this.get(i);null!==n&&(e[i]=n)}}),e}getSize(){let t=0;return Object.keys(localStorage).forEach(e=>{if(e.startsWith(this.prefix)){const i=localStorage.getItem(e);i&&(t+=i.length+e.length)}}),t}isAvailable(){try{const t="__test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch(t){return!1}}}new t,new class{constructor(e={}){this.mediaQuery=null,this.config=Object.assign({storageKey:"theme",defaultTheme:"auto",onChange:()=>{}},e),this.storage=new t({prefix:"keigo_theme_"}),this.systemTheme=this.getSystemTheme(),this.currentTheme=this.loadTheme(),this.init()}init(){"undefined"!=typeof window&&(this.applyTheme(),this.setupSystemThemeListener(),this.setupToggleButton())}getSystemTheme(){return"undefined"==typeof window?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}loadTheme(){return this.storage.get(this.config.storageKey)||this.config.defaultTheme}saveTheme(t){this.storage.set(this.config.storageKey,t)}setupSystemThemeListener(){if("undefined"==typeof window)return;this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)");const t=t=>{this.systemTheme=t.matches?"dark":"light","auto"===this.currentTheme&&this.applyTheme()};this.mediaQuery.addEventListener?this.mediaQuery.addEventListener("change",t):this.mediaQuery.addListener(t)}applyTheme(){const t=this.getEffectiveTheme();document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(t),document.documentElement.setAttribute("data-theme",t),this.updateToggleButton(t),this.config.onChange(this.currentTheme)}getEffectiveTheme(){return"auto"===this.currentTheme?this.systemTheme:this.currentTheme}setupToggleButton(){const t=document.getElementById("dark-mode-toggle");if(!t)return;t.addEventListener("click",()=>this.toggle());const e=this.getEffectiveTheme();this.updateToggleButton(e)}updateToggleButton(t){const e=document.getElementById("dark-mode-toggle");e&&(e.innerHTML={light:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"/>\n        <path d="M13 1h-2v3h2V1zm0 19h-2v3h2v-3zM4 11H1v2h3v-2zm19 0h-3v2h3v-2z"/>\n        <path transform="rotate(-45 6.343 6.343)" d="M5.343 5.343h2v2h-2z"/>\n        <path transform="rotate(-45 17.657 17.657)" d="M16.657 16.657h2v2h-2z"/>\n        <path transform="rotate(45 6.343 17.657)" d="M5.343 16.657h2v2h-2z"/>\n        <path transform="rotate(45 17.657 6.343)" d="M16.657 5.343h2v2h-2z"/>\n      </svg>',dark:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3 0-5.4-2.4-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>\n      </svg>'}[t],e.setAttribute("aria-label","light"===t?"ダークモードに切り替え":"ライトモードに切り替え"))}setTheme(t){this.currentTheme=t,this.saveTheme(t),this.applyTheme()}getTheme(){return this.currentTheme}getEffectiveThemeValue(){return this.getEffectiveTheme()}toggle(){const t=["light","dark","auto"],e=(t.indexOf(this.currentTheme)+1)%t.length;this.setTheme(t[e])}isAvailable(){return this.storage.isAvailable()}static addCustomTheme(t,e){const i=document.createElement("style");i.textContent=`\n      [data-theme="${t}"] {\n        ${Object.entries(e).map(([t,e])=>`--${t}: ${e};`).join("\n")}\n      }\n    `,document.head.appendChild(i)}},new class{constructor(t={}){this.container=null,this.notifications=new Map,this.defaultOptions={duration:3e3,position:"top",persistent:!1},this.defaultOptions=Object.assign(Object.assign({},this.defaultOptions),t),this.init()}init(){"undefined"!=typeof document&&(this.container=document.getElementById("notification-container"),this.container||(this.container=document.createElement("div"),this.container.id="notification-container",this.container.className="notification-container",this.applyContainerStyles(),document.body.appendChild(this.container)))}applyContainerStyles(){if(!this.container)return;const t={position:"fixed",zIndex:"9999",pointerEvents:"none",display:"flex",flexDirection:"column",gap:"10px",padding:"20px"};switch(this.defaultOptions.position||"top"){case"top":t.top="0",t.left="50%",t.transform="translateX(-50%)";break;case"bottom":t.bottom="0",t.left="50%",t.transform="translateX(-50%)";break;case"top-right":t.top="0",t.right="0";break;case"top-left":t.top="0",t.left="0";break;case"bottom-right":t.bottom="0",t.right="0";break;case"bottom-left":t.bottom="0",t.left="0"}Object.assign(this.container.style,t)}show(t,e="info",i={}){const n=Object.assign(Object.assign({},this.defaultOptions),i),s=`notification-${Date.now()}`,o=this.createNotification(s,t,e,n);return this.container||this.init(),this.container&&(this.container.appendChild(o),this.notifications.set(s,o),requestAnimationFrame(()=>{o.classList.add("notification-show")}),n.persistent||setTimeout(()=>{this.hide(s)},n.duration)),s}createNotification(t,e,i,n){const s=document.createElement("div");s.id=t,s.className=`notification notification-${i} ${n.className||""}`;const o={padding:"12px 20px",borderRadius:"4px",backgroundColor:this.getBackgroundColor(i),color:"#fff",fontSize:"14px",lineHeight:"1.5",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",pointerEvents:"auto",cursor:n.onClick?"pointer":"default",opacity:"0",transform:"translateY(-20px)",transition:"all 0.3s ease",maxWidth:"400px",wordWrap:"break-word"};if(Object.assign(s.style,o),s.innerHTML=`\n      <div style="display: flex; align-items: center; gap: 10px;">\n        <span style="flex: 1;">${e}</span>\n        ${n.persistent?'<button class="notification-close" style="background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; padding: 0; margin-left: 10px;">&times;</button>':""}\n      </div>\n    `,n.onClick&&s.addEventListener("click",t=>{t.target.classList.contains("notification-close")||n.onClick()}),n.persistent){const e=s.querySelector(".notification-close");e&&e.addEventListener("click",()=>this.hide(t))}return s}getBackgroundColor(t){return{success:"#4caf50",error:"#f44336",warning:"#ff9800",info:"#2196f3"}[t]}hide(t){const e=this.notifications.get(t);e&&(e.classList.remove("notification-show"),e.style.opacity="0",e.style.transform="translateY(-20px)",setTimeout(()=>{e.remove(),this.notifications.delete(t)},300))}hideAll(){this.notifications.forEach((t,e)=>this.hide(e))}success(t,e){return this.show(t,"success",e)}error(t,e){return this.show(t,"error",e)}warning(t,e){return this.show(t,"warning",e)}info(t,e){return this.show(t,"info",e)}}})();