class HonorificLevelAssessment{constructor(){this.assessmentData=null,this.currentQuestionIndex=0,this.answers=[],this.startTime=null,this.categoryScores={}}async loadAssessmentData(){try{const e=await fetch("/data/honorific-level-assessment.json"),s=await e.json();return this.assessmentData=s.assessmentData,!0}catch(e){return console.error("診断データの読み込みに失敗しました:",e),!1}}startAssessment(){return this.currentQuestionIndex=0,this.answers=[],this.startTime=new Date,this.categoryScores={},this.assessmentData&&this.assessmentData.categoryAnalysis?(Object.keys(this.assessmentData.categoryAnalysis).forEach(e=>{this.categoryScores[e]={totalScore:0,maxScore:0,count:0}}),!0):(console.error("Assessment data not properly loaded"),!1)}getNextQuestion(){return this.assessmentData&&this.assessmentData.questions?this.currentQuestionIndex<this.assessmentData.questions.length?this.assessmentData.questions[this.currentQuestionIndex]:null:(console.error("No assessment data available"),null)}recordAnswer(e,s,t){if(!this.assessmentData||!this.assessmentData.questions)return void console.error("No assessment data available");const a=this.assessmentData.questions.find(s=>s.id===e);if(!a)return;this.answers.push({questionId:e,selectedOptionIndex:s,score:t,category:a.category,isCorrect:10===t});const r=a.category;this.categoryScores[r]||(this.categoryScores[r]={totalScore:0,maxScore:0,count:0}),this.categoryScores[r].totalScore+=t,this.categoryScores[r].maxScore+=10,this.categoryScores[r].count+=1,this.currentQuestionIndex++}calculateResults(){if(!this.assessmentData||!this.assessmentData.questions||!this.assessmentData.levels)return console.error("Assessment data is incomplete"),null;const e=this.answers.reduce((e,s)=>e+s.score,0),s=10*this.assessmentData.questions.length,t=Math.round(e/s*100);let a=null;for(const[e,s]of Object.entries(this.assessmentData.levels))if(t>=s.scoreRange[0]&&t<=s.scoreRange[1]){a={key:e,...s};break}if(!a)return console.error("Could not determine level for percentage:",t),null;const r=this.analyzeCategoriesWeakness(),o=new Date;return{totalScore:e,maxScore:s,percentage:t,level:a,categoryAnalysis:r,duration:Math.round((o-this.startTime)/1e3),correctAnswers:this.answers.filter(e=>e.isCorrect).length,totalQuestions:this.assessmentData.questions.length}}analyzeCategoriesWeakness(){const e=[];for(const[s,t]of Object.entries(this.categoryScores)){if(0===t.count)continue;const a=Math.round(t.totalScore/t.maxScore*100),r=this.assessmentData.categoryAnalysis[s].weight,o=a*r;e.push({category:s,percentage:a,weight:r,weightedScore:o,description:this.assessmentData.categoryAnalysis[s].description,isWeak:a<70,questionCount:t.count})}return e.sort((e,s)=>e.percentage-s.percentage),e}generateLearningPlan(e){const s={immediateActions:[],shortTermGoals:[],longTermGoals:[],recommendedResources:[]};if(!e||!e.categoryAnalysis)return console.error("Invalid results data"),s;const t=e.categoryAnalysis.filter(e=>e.isWeak);return t.forEach(e=>{s.immediateActions.push({category:e.category,action:`${e.category}の基礎を復習する`,priority:"high",estimatedTime:"30分/日"})}),"beginner"===e.level.key?s.shortTermGoals=["基本的な敬語動詞を10個マスターする","ビジネスメールの定型文を覚える","毎日1つの敬語表現を実践で使う"]:"intermediate"===e.level.key?s.shortTermGoals=["場面別の敬語使い分けを練習する","クッション言葉のレパートリーを増やす","二重敬語のチェックを習慣化する"]:"advanced"===e.level.key&&(s.shortTermGoals=["微妙なニュアンスの使い分けを意識する","現代的な敬語表現を取り入れる","相手との関係性に応じた調整を練習する"]),s.longTermGoals=["3ヶ月後に次のレベルに到達する","実践的な場面で自然に敬語を使えるようになる","敬語の知識を体系的に整理する"],e.level&&e.level.key&&(s.recommendedResources=this.getRecommendedResources(e.level.key,t)),s}getRecommendedResources(e,s){const t=[];return t.push(...{beginner:[{type:"article",title:"敬語の基本：尊敬語・謙譲語・丁寧語の違い",url:"/尊敬語-謙譲語-丁寧語/"},{type:"practice",title:"基本動詞の敬語変換練習",url:"/converter-demo/"}],intermediate:[{type:"article",title:"二重敬語を避ける方法",url:"/二重敬語/"},{type:"practice",title:"場面別敬語クイズ",url:"/quiz-demo/"}],advanced:[{type:"article",title:"させていただくの正しい使い方",url:"/させていただく/"},{type:"practice",title:"敬語実例集",url:"/examples-demo/"}]}[e]||[]),s.forEach(e=>{"ビジネス敬語"===e.category?t.push({type:"article",title:"ビジネスメールの敬語",url:"/宜しくお願い致します/"}):"間違えやすい敬語"===e.category&&t.push({type:"article",title:"よくある敬語の間違い",url:"/了解しました-承知しました/"})}),t}}window.HonorificLevelAssessment=HonorificLevelAssessment;