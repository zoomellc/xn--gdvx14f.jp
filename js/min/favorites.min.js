!function(){"use strict";class t{constructor(){this.favorites=[],this.storageKey="keigo-jp-favorites",this.maxFavorites=100,this.init()}async init(){this.loadFavorites(),this.setupUI(),this.attachEventListeners(),this.updateFavoriteButtons()}loadFavorites(){const t=localStorage.getItem(this.storageKey);if(t)try{this.favorites=JSON.parse(t)}catch(t){console.error("Failed to parse favorites:",t),this.favorites=[]}}saveFavorites(){localStorage.setItem(this.storageKey,JSON.stringify(this.favorites))}isFavorite(t){return this.favorites.some(e=>e.id===t)}toggleFavorite(t){const e=this.favorites.findIndex(e=>e.id===t.id);if(e>-1)this.favorites.splice(e,1),this.onFavoriteRemoved(t);else{if(this.favorites.length>=this.maxFavorites)return void this.showMessage("お気に入りの上限に達しました。既存のお気に入りを削除してください。");this.favorites.unshift({id:t.id,title:t.title,url:t.url,excerpt:t.excerpt,savedAt:(new Date).toISOString()}),this.onFavoriteAdded(t)}this.saveFavorites(),this.updateFavoriteButtons(),this.updateFavoritesList()}onFavoriteAdded(t){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.active&&e.active.postMessage({type:"CACHE_ARTICLE",url:t.url})}),this.showMessage("お気に入りに追加しました")}onFavoriteRemoved(t){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.active&&e.active.postMessage({type:"UNCACHE_ARTICLE",url:t.url})}),this.showMessage("お気に入りから削除しました")}setupUI(){this.injectStyles(),this.createFavoriteButtons(),this.createFavoritesModal(),this.createMessageContainer()}injectStyles(){const t=document.createElement("style");t.textContent="\n                .favorite-button {\n                    background: none;\n                    border: none;\n                    cursor: pointer;\n                    padding: 8px;\n                    border-radius: 50%;\n                    transition: all 0.3s ease;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                \n                .favorite-button:hover {\n                    background-color: rgba(59, 130, 246, 0.1);\n                }\n                \n                .favorite-button svg {\n                    width: 24px;\n                    height: 24px;\n                    fill: none;\n                    stroke: #6b7280;\n                    stroke-width: 2;\n                    transition: all 0.3s ease;\n                }\n                \n                .favorite-button.is-favorite svg {\n                    fill: #f59e0b;\n                    stroke: #f59e0b;\n                }\n                \n                .favorites-modal {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background-color: rgba(0, 0, 0, 0.5);\n                    display: none;\n                    z-index: 1000;\n                    padding: 20px;\n                    overflow-y: auto;\n                }\n                \n                .favorites-modal.show {\n                    display: block;\n                }\n                \n                .favorites-modal-content {\n                    background-color: var(--bg-color, #ffffff);\n                    color: var(--text-color, #000000);\n                    max-width: 600px;\n                    margin: 0 auto;\n                    padding: 30px;\n                    border-radius: 10px;\n                    position: relative;\n                }\n                \n                .favorites-modal-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 20px;\n                }\n                \n                .favorites-modal-close {\n                    background: none;\n                    border: none;\n                    font-size: 24px;\n                    cursor: pointer;\n                    color: var(--text-color, #000000);\n                }\n                \n                .favorites-list {\n                    list-style: none;\n                    padding: 0;\n                    margin: 0;\n                }\n                \n                .favorites-list-item {\n                    padding: 15px;\n                    border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: start;\n                }\n                \n                .favorites-list-item:last-child {\n                    border-bottom: none;\n                }\n                \n                .favorites-item-content {\n                    flex: 1;\n                    margin-right: 10px;\n                }\n                \n                .favorites-item-title {\n                    font-weight: bold;\n                    margin-bottom: 5px;\n                    color: var(--link-color, #3b82f6);\n                    text-decoration: none;\n                    display: block;\n                }\n                \n                .favorites-item-title:hover {\n                    text-decoration: underline;\n                }\n                \n                .favorites-item-excerpt {\n                    font-size: 14px;\n                    color: var(--text-color-secondary, #6b7280);\n                    margin-bottom: 5px;\n                }\n                \n                .favorites-item-date {\n                    font-size: 12px;\n                    color: var(--text-color-secondary, #9ca3af);\n                }\n                \n                .favorites-empty {\n                    text-align: center;\n                    padding: 40px;\n                    color: var(--text-color-secondary, #6b7280);\n                }\n                \n                .favorites-fab {\n                    position: fixed;\n                    bottom: 80px;\n                    right: 20px;\n                    background-color: #f59e0b;\n                    color: white;\n                    border: none;\n                    border-radius: 50%;\n                    width: 56px;\n                    height: 56px;\n                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n                    cursor: pointer;\n                    z-index: 999;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    transition: transform 0.3s ease;\n                }\n                \n                .favorites-fab:hover {\n                    transform: scale(1.1);\n                }\n                \n                .favorites-message {\n                    position: fixed;\n                    top: 20px;\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background-color: var(--bg-color, #1f2937);\n                    color: var(--text-color, #ffffff);\n                    padding: 12px 24px;\n                    border-radius: 8px;\n                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n                    z-index: 2000;\n                    opacity: 0;\n                    transition: opacity 0.3s ease;\n                }\n                \n                .favorites-message.show {\n                    opacity: 1;\n                }\n                \n                .favorites-export-section {\n                    margin-bottom: 20px;\n                    text-align: right;\n                }\n                \n                .favorites-export-button {\n                    background-color: #3b82f6;\n                    color: white;\n                    border: none;\n                    padding: 8px 16px;\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-size: 14px;\n                    transition: background-color 0.3s ease;\n                }\n                \n                .favorites-export-button:hover {\n                    background-color: #2563eb;\n                }\n                \n                .favorites-export-options {\n                    position: absolute;\n                    right: 30px;\n                    margin-top: 5px;\n                    background-color: var(--bg-color, #ffffff);\n                    border: 1px solid rgba(0, 0, 0, 0.1);\n                    border-radius: 6px;\n                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n                    z-index: 1001;\n                }\n                \n                .export-option {\n                    display: block;\n                    width: 100%;\n                    padding: 10px 20px;\n                    border: none;\n                    background: none;\n                    color: var(--text-color, #000000);\n                    cursor: pointer;\n                    text-align: left;\n                    font-size: 14px;\n                    transition: background-color 0.2s ease;\n                }\n                \n                .export-option:hover {\n                    background-color: rgba(59, 130, 246, 0.1);\n                }\n                \n                .export-option:first-child {\n                    border-radius: 6px 6px 0 0;\n                }\n                \n                .export-option:last-child {\n                    border-radius: 0 0 6px 6px;\n                }\n            ",document.head.appendChild(t)}createFavoriteButtons(){document.querySelectorAll("article, .article-item, .post-item").forEach(t=>{const e=t.querySelector("h1, h2, h3, .article-title, .post-title"),n=t.querySelector("a");if(e&&n){const o=document.createElement("button");o.className="favorite-button",o.innerHTML='\n                        <svg viewBox="0 0 24 24">\n                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                        </svg>\n                    ';const i=t.querySelector(".excerpt, .summary, p")?.textContent?.trim(),a={id:n.href,title:e.textContent.trim(),url:n.href,excerpt:i?i.substring(0,100)+"...":""};o.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.toggleFavorite(a)}),e.parentNode.insertBefore(o,e.nextSibling)}})}createFavoritesModal(){const t=document.createElement("div");t.className="favorites-modal",t.innerHTML='\n                <div class="favorites-modal-content">\n                    <div class="favorites-modal-header">\n                        <h2>お気に入り記事</h2>\n                        <button class="favorites-modal-close">&times;</button>\n                    </div>\n                    <div class="favorites-export-section">\n                        <button class="favorites-export-button">エクスポート</button>\n                        <div class="favorites-export-options" style="display: none;">\n                            <button class="export-option" data-format="json">JSON形式</button>\n                            <button class="export-option" data-format="csv">CSV形式</button>\n                            <button class="export-option" data-format="markdown">Markdown形式</button>\n                            <button class="export-option" data-format="html">HTML形式</button>\n                        </div>\n                    </div>\n                    <div class="favorites-list-container"></div>\n                </div>\n            ',document.body.appendChild(t),this.modal=t,this.modalContent=t.querySelector(".favorites-list-container"),t.querySelector(".favorites-modal-close").addEventListener("click",()=>{this.hideModal()}),t.addEventListener("click",e=>{e.target===t&&this.hideModal()});const e=t.querySelector(".favorites-export-button"),n=t.querySelector(".favorites-export-options");e.addEventListener("click",t=>{t.stopPropagation(),n.style.display="none"===n.style.display?"block":"none"}),t.querySelectorAll(".export-option").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.format;this.exportFavorites(e),n.style.display="none"})}),t.querySelector(".favorites-modal-content").addEventListener("click",()=>{n.style.display="none"})}createMessageContainer(){const t=document.createElement("div");t.className="favorites-message",document.body.appendChild(t),this.messageContainer=t}showMessage(t){this.messageContainer.textContent=t,this.messageContainer.classList.add("show"),setTimeout(()=>{this.messageContainer.classList.remove("show")},3e3)}attachEventListeners(){const t=document.createElement("button");t.className="favorites-fab",t.innerHTML='\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">\n                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                </svg>\n            ',t.addEventListener("click",()=>{this.showModal()}),document.body.appendChild(t),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.modal.classList.contains("show")&&this.hideModal()})}updateFavoriteButtons(){document.querySelectorAll(".favorite-button").forEach(t=>{const e=t.closest("article, .article-item, .post-item"),n=e?.querySelector("a");if(n){const e=this.isFavorite(n.href);t.classList.toggle("is-favorite",e)}})}updateFavoritesList(){if(!this.modalContent)return;if(0===this.favorites.length)return void(this.modalContent.innerHTML='<div class="favorites-empty">お気に入り記事がありません</div>');const t=document.createElement("ul");t.className="favorites-list",this.favorites.forEach(e=>{const n=document.createElement("li");n.className="favorites-list-item";const o=new Date(e.savedAt).toLocaleDateString("ja-JP");n.innerHTML=`\n                    <div class="favorites-item-content">\n                        <a href="${e.url}" class="favorites-item-title">${e.title}</a>\n                        <div class="favorites-item-excerpt">${e.excerpt}</div>\n                        <div class="favorites-item-date">保存日: ${o}</div>\n                    </div>\n                    <button class="favorite-button is-favorite" data-id="${e.id}">\n                        <svg viewBox="0 0 24 24">\n                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                        </svg>\n                    </button>\n                `,n.querySelector(".favorite-button").addEventListener("click",t=>{t.preventDefault(),this.toggleFavorite(e)}),t.appendChild(n)}),this.modalContent.innerHTML="",this.modalContent.appendChild(t)}showModal(){this.updateFavoritesList(),this.modal.classList.add("show"),document.body.style.overflow="hidden"}hideModal(){this.modal.classList.remove("show"),document.body.style.overflow=""}exportFavorites(t){if(0===this.favorites.length)return void this.showMessage("エクスポートする記事がありません");let e="",n=`keigo-jp-favorites-${(new Date).toISOString().split("T")[0]}`,o="text/plain";switch(t){case"json":e=JSON.stringify(this.favorites,null,2),n+=".json",o="application/json";break;case"csv":e=this.generateCSV(),n+=".csv",o="text/csv";break;case"markdown":e=this.generateMarkdown(),n+=".md",o="text/markdown";break;case"html":e=this.generateHTML(),n+=".html",o="text/html"}this.downloadFile(e,n,o),this.showMessage(`${t.toUpperCase()}形式でエクスポートしました`)}generateCSV(){const t=this.favorites.map(t=>[`"${t.title.replace(/"/g,'""')}"`,t.url,`"${t.excerpt.replace(/"/g,'""')}"`,new Date(t.savedAt).toLocaleDateString("ja-JP")]);return[["タイトル","URL","概要","保存日"].join(","),...t.map(t=>t.join(","))].join("\n")}generateMarkdown(){let t="# 敬語.jp お気に入り記事\n\n";return t+=`エクスポート日: ${(new Date).toLocaleDateString("ja-JP")}\n\n`,this.favorites.forEach((e,n)=>{t+=`## ${n+1}. ${e.title}\n\n`,t+=`- **URL**: [${e.url}](${e.url})\n`,t+=`- **概要**: ${e.excerpt}\n`,t+=`- **保存日**: ${new Date(e.savedAt).toLocaleDateString("ja-JP")}\n\n`}),t}generateHTML(){return`<!DOCTYPE html>\n<html lang="ja">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>敬語.jp お気に入り記事</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            line-height: 1.6;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n            background-color: #f5f5f5;\n        }\n        h1 {\n            color: #333;\n            border-bottom: 2px solid #3b82f6;\n            padding-bottom: 10px;\n        }\n        .article {\n            background: white;\n            padding: 20px;\n            margin-bottom: 20px;\n            border-radius: 8px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .article-title {\n            font-size: 1.2em;\n            font-weight: bold;\n            margin-bottom: 10px;\n        }\n        .article-title a {\n            color: #3b82f6;\n            text-decoration: none;\n        }\n        .article-title a:hover {\n            text-decoration: underline;\n        }\n        .article-excerpt {\n            color: #666;\n            margin-bottom: 10px;\n        }\n        .article-date {\n            color: #999;\n            font-size: 0.9em;\n        }\n        .export-info {\n            background: #e3f2fd;\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 20px;\n        }\n    </style>\n</head>\n<body>\n    <h1>敬語.jp お気に入り記事</h1>\n    <div class="export-info">\n        <p>エクスポート日: ${(new Date).toLocaleDateString("ja-JP")}</p>\n        <p>記事数: ${this.favorites.length}件</p>\n    </div>\n    ${this.favorites.map(t=>`\n        <div class="article">\n            <div class="article-title">\n                <a href="${t.url}" target="_blank">${t.title}</a>\n            </div>\n            <div class="article-excerpt">${t.excerpt}</div>\n            <div class="article-date">保存日: ${new Date(t.savedAt).toLocaleDateString("ja-JP")}</div>\n        </div>\n    `).join("")}\n</body>\n</html>`}downloadFile(t,e,n){const o=new Blob([t],{type:n+";charset=utf-8"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new t}):new t}();