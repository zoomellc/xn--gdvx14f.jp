!function(){"use strict";const t={config:{storageKey:"dataSaverSettings",enabledKey:"dataSaverEnabled",autoDetect:!0,lowQualityThreshold:.5,imageQuality:{high:1,medium:.7,low:.4}},state:{enabled:!1,autoEnabled:!1,networkQuality:"high",savedBytes:0},init:function(){this.loadSettings(),this.detectDataSavePreference(),this.setupNetworkMonitoring(),this.applyDataSaverMode(),this.setupUI(),this.trackDataSavings()},loadSettings:function(){try{const t=localStorage.getItem(this.config.enabledKey);null!==t&&(this.state.enabled="true"===t);const e=localStorage.getItem(this.config.storageKey);if(e){const t=JSON.parse(e);Object.assign(this.state,t)}}catch(t){this.log("Error loading settings:",t)}},saveSettings:function(){try{localStorage.setItem(this.config.enabledKey,this.state.enabled),localStorage.setItem(this.config.storageKey,JSON.stringify(this.state))}catch(t){this.log("Error saving settings:",t)}},detectDataSavePreference:function(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t&&t.saveData&&(this.state.autoEnabled=!0,this.state.enabled=!0,this.log("Save-Data preference detected, enabling data saver")),t){const e=t.effectiveType;"2g"!==e&&"slow-2g"!==e||(this.state.autoEnabled=!0,this.state.enabled=!0,this.log("Slow connection detected, enabling data saver"))}},setupNetworkMonitoring:function(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t&&(t.addEventListener("change",()=>{if(this.updateNetworkQuality(),this.config.autoDetect){const t=this.state.enabled;this.detectDataSavePreference(),t!==this.state.enabled&&this.applyDataSaverMode()}}),this.updateNetworkQuality())},updateNetworkQuality:function(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!t)return void(this.state.networkQuality="unknown");const e=t.effectiveType,a=t.downlink;this.state.networkQuality="4g"===e&&a>10?"high":"3g"===e||"4g"===e&&a<=10?"medium":"low",this.log("Network quality:",this.state.networkQuality)},applyDataSaverMode:function(){this.state.enabled?(document.body.classList.add("data-saver-mode"),this.optimizeImages(),this.optimizeVideos(),this.optimizeFonts(),this.deferNonCriticalResources(),this.setupLazyLoading(),this.log("Data saver mode enabled")):(document.body.classList.remove("data-saver-mode"),this.restoreFullQuality(),this.log("Data saver mode disabled"))},optimizeImages:function(){document.querySelectorAll("img[src], img[data-src]").forEach(t=>{t.dataset.originalSrc||(t.dataset.originalSrc=t.src||t.dataset.src);const e=t.dataset.originalSrc;if(e){const a=this.getOptimizedImageUrl(e);t.src?t.src=a:t.dataset.src=a,this.estimateImageSavings(e,a)}t.loading="lazy"}),this.optimizeBackgroundImages()},getOptimizedImageUrl:function(t){if(t.includes("quality=")||t.includes("q="))return t;let e;switch(this.state.networkQuality){case"low":e=this.config.imageQuality.low;break;case"medium":e=this.config.imageQuality.medium;break;default:e=this.config.imageQuality.high}const a=t.includes("?")?"&":"?";return`${t}${a}quality=${e}`},optimizeBackgroundImages:function(){document.querySelectorAll('[style*="background-image"]').forEach(t=>{const e=t.style.backgroundImage.match(/url\(['"]?([^'")]+)['"]?\)/);if(e&&e[1]){const a=e[1],n=this.getOptimizedImageUrl(a);t.style.backgroundImage=`url('${n}')`}})},optimizeVideos:function(){document.querySelectorAll("video").forEach(t=>{t.autoplay=!1,t.preload="none",t.poster||(t.poster='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ctext x="50" y="50" text-anchor="middle" dy=".3em" fill="%23666"%3EClick to load video%3C/text%3E%3C/svg%3E'),t.querySelectorAll("source").forEach(t=>{t.dataset.lowQuality&&(t.dataset.originalSrc=t.src,t.src=t.dataset.lowQuality)})}),this.optimizeIframes()},optimizeIframes:function(){document.querySelectorAll('iframe[src*="youtube"], iframe[src*="vimeo"]').forEach(t=>{t.dataset.originalSrc||(t.dataset.originalSrc=t.src);const e=document.createElement("div");e.className="video-placeholder",e.innerHTML='\n          <div class="play-button">â–¶</div>\n          <div class="message">Click to load video</div>\n        ',e.style.cssText=`\n          position: relative;\n          width: ${t.width||"100%"};\n          height: ${t.height||"315px"};\n          background: #000;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n        `,e.addEventListener("click",()=>{t.src=t.dataset.originalSrc,e.replaceWith(t)}),t.src="about:blank",t.replaceWith(e)})},optimizeFonts:function(){const t=document.createElement("style");t.id="data-saver-fonts",t.textContent='\n        .data-saver-mode body {\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, \n                       "Helvetica Neue", Arial, sans-serif !important;\n        }\n        .data-saver-mode h1, .data-saver-mode h2, .data-saver-mode h3,\n        .data-saver-mode h4, .data-saver-mode h5, .data-saver-mode h6 {\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, \n                       "Helvetica Neue", Arial, sans-serif !important;\n        }\n      ',document.head.appendChild(t),"fonts"in document&&document.fonts.forEach(t=>{t.family.includes("system")||t.loaded.then(()=>{this.state.savedBytes+=5e4})})},deferNonCriticalResources:function(){document.querySelectorAll('link[rel="stylesheet"]').forEach(t=>{t.href.includes("critical")||t.href.includes("blonde")||(t.media="print",t.onload=function(){this.media="all"})}),document.querySelectorAll("script[src]").forEach(t=>{if(!t.defer&&!t.async&&!t.src.includes("critical")){const e=document.createElement("script");e.src=t.src,e.defer=!0,t.replaceWith(e)}})},setupLazyLoading:function(){if("IntersectionObserver"in window){const t=new IntersectionObserver((t,e)=>{t.forEach(t=>{if(t.isIntersecting){const a=t.target;a.dataset.src&&(a.src=a.dataset.src,a.removeAttribute("data-src"),e.unobserve(a))}})},{rootMargin:"50px 0px",threshold:.01});document.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}},restoreFullQuality:function(){document.querySelectorAll("img[data-original-src]").forEach(t=>{t.dataset.originalSrc&&(t.src=t.dataset.originalSrc)}),document.querySelectorAll("video source[data-original-src]").forEach(t=>{t.dataset.originalSrc&&(t.src=t.dataset.originalSrc)});const t=document.getElementById("data-saver-fonts");t&&t.remove()},estimateImageSavings:function(t,e){const a=1e5,n=a-a*parseFloat(e.match(/quality=([\d.]+)/)?.[1]||1);this.state.savedBytes+=n,this.updateSavingsDisplay()},trackDataSavings:function(){"PerformanceObserver"in window&&new PerformanceObserver(t=>{for(const e of t.getEntries())"resource"===e.entryType&&this.state.enabled&&0===e.transferSize&&(this.state.savedBytes+=e.decodedBodySize||5e4,this.updateSavingsDisplay())}).observe({entryTypes:["resource"]})},setupUI:function(){const t=document.createElement("div");t.id="data-saver-toggle",t.className="data-saver-toggle",t.innerHTML=`\n        <button aria-label="Toggle data saver mode">\n          <span class="icon">ðŸ“¶</span>\n          <span class="label">Data Saver</span>\n          <span class="status">${this.state.enabled?"ON":"OFF"}</span>\n        </button>\n        <div class="savings" style="display: none;">\n          Saved: <span class="amount">0 KB</span>\n        </div>\n      `,t.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        padding: 10px;\n        z-index: 1000;\n        font-size: 14px;\n      ",t.querySelector("button").addEventListener("click",()=>{this.toggle()}),document.body.appendChild(t),this.updateToggleStatus(),document.addEventListener("keydown",t=>{t.ctrlKey&&t.shiftKey&&"S"===t.key&&(t.preventDefault(),this.toggle())})},updateToggleStatus:function(){const t=document.getElementById("data-saver-toggle");if(t){const e=t.querySelector(".status"),a=t.querySelector("button");e.textContent=this.state.enabled?"ON":"OFF",a.classList.toggle("active",this.state.enabled),this.state.autoEnabled&&(e.textContent+=" (Auto)")}},updateSavingsDisplay:function(){const t=document.getElementById("data-saver-toggle");if(t&&this.state.savedBytes>0){const e=t.querySelector(".savings"),a=t.querySelector(".amount");e.style.display="block",a.textContent=this.formatBytes(this.state.savedBytes)}},formatBytes:function(t){return t<1024?t+" B":t<1048576?(t/1024).toFixed(1)+" KB":(t/1048576).toFixed(1)+" MB"},toggle:function(){this.state.enabled=!this.state.enabled,this.state.autoEnabled=!1,this.saveSettings(),this.applyDataSaverMode(),this.updateToggleStatus(),window.gtag&&window.gtag("event","data_saver_toggle",{enabled:this.state.enabled})},isEnabled:function(){return this.state.enabled},getSavings:function(){return{bytes:this.state.savedBytes,formatted:this.formatBytes(this.state.savedBytes)}},log:function(...t){console.log("[Data Saver]",...t)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.init()}):t.init(),window.DataSaver=t}();