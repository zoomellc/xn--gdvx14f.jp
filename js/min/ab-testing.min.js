!function(){"use strict";const t={config:{storageKey:"abTestExperiments",cookieExpiry:30,defaultSplitRatio:.5,enableLogging:!0},experiments:{},init:function(){this.loadExperiments(),this.assignUserToExperiments(),this.trackExperimentViews(),this.setupEventListeners()},loadExperiments:function(){this.experiments={"header-redesign":{name:"Header Redesign Test",variants:{control:{weight:.5},variant1:{weight:.5}},goals:["click-rate","engagement"],startDate:"2025-01-01",endDate:"2025-02-01",active:!0},"button-color":{name:"Button Color Test",variants:{control:{weight:.33,color:"blue"},green:{weight:.33,color:"green"},red:{weight:.34,color:"red"}},goals:["conversion","click-rate"],active:!0},"content-layout":{name:"Content Layout Test",variants:{control:{weight:.5,layout:"single-column"},variant1:{weight:.5,layout:"two-column"}},goals:["time-on-page","scroll-depth"],active:!0}},this.loadDynamicExperiments()},loadDynamicExperiments:function(){try{const t=localStorage.getItem(this.config.storageKey);if(t){const e=JSON.parse(t);Object.assign(this.experiments,e)}}catch(t){this.log("Error loading dynamic experiments:",t)}},assignUserToExperiments:function(){const t=this.getUserAssignments();Object.keys(this.experiments).forEach(e=>{const n=this.experiments[e];if(n.active&&this.isExperimentActive(n))if(t[e])n.userVariant=t[e];else{const s=this.selectVariant(n.variants);t[e]=s,n.userVariant=s}}),this.saveUserAssignments(t),this.applyExperiments()},isExperimentActive:function(t){const e=new Date;return!(t.startDate&&e<new Date(t.startDate))&&!(t.endDate&&e>new Date(t.endDate))},selectVariant:function(t){const e=Math.random();let n=0;for(const[s,a]of Object.entries(t))if(n+=a.weight,e<n)return s;return Object.keys(t)[0]},getUserAssignments:function(){try{const t=this.getCookie("ab_assignments");if(t)return JSON.parse(decodeURIComponent(t))}catch(t){this.log("Error reading assignments:",t)}return{}},saveUserAssignments:function(t){const e=new Date;e.setDate(e.getDate()+this.config.cookieExpiry),this.setCookie("ab_assignments",encodeURIComponent(JSON.stringify(t)),e)},applyExperiments:function(){Object.keys(this.experiments).forEach(t=>{const e=this.experiments[t];if(!e.userVariant)return;document.body.classList.add(`ab-${t}-${e.userVariant}`);const n=this.experimentHandlers[t];n&&"function"==typeof n&&n(e.userVariant,e)})},experimentHandlers:{"header-redesign":function(t,e){if("variant1"===t){const t=document.querySelector("header");t&&t.classList.add("redesigned")}},"button-color":function(t,e){const n=document.querySelectorAll(".cta-button"),s=e.variants[t].color;n.forEach(t=>{t.style.backgroundColor=s})},"content-layout":function(t,e){const n=document.querySelector(".content-area");if(n){const s=e.variants[t].layout;n.classList.add(`layout-${s}`)}}},trackExperimentViews:function(){Object.keys(this.experiments).forEach(t=>{const e=this.experiments[t];e.userVariant&&this.trackEvent("experiment_view",{experiment_id:t,variant:e.userVariant,timestamp:(new Date).toISOString()})})},setupEventListeners:function(){document.addEventListener("click",t=>{const e=t.target;e.matches(".cta-button, .ab-track-click")&&this.trackGoal("click-rate",{element:e.tagName,class:e.className,text:e.textContent}),e.matches(".conversion-action, .ab-track-conversion")&&this.trackGoal("conversion",{element:e.tagName,value:e.dataset.value||1})});let t=Date.now();window.addEventListener("beforeunload",()=>{const e=(Date.now()-t)/1e3;this.trackGoal("time-on-page",{duration:e})});let e=0;window.addEventListener("scroll",()=>{const t=(window.scrollY+window.innerHeight)/document.body.scrollHeight;e=Math.max(e,t)}),window.addEventListener("beforeunload",()=>{this.trackGoal("scroll-depth",{depth:e})});let n=0;["click","mousemove","keydown","touchstart"].forEach(t=>{document.addEventListener(t,()=>{n++})}),setInterval(()=>{n>0&&(this.trackGoal("engagement",{score:n}),n=0)},3e4)},trackGoal:function(t,e={}){Object.keys(this.experiments).forEach(n=>{const s=this.experiments[n];s.userVariant&&s.goals.includes(t)&&this.trackEvent("goal_achieved",{experiment_id:n,variant:s.userVariant,goal:t,data:e,timestamp:(new Date).toISOString()})})},trackEvent:function(t,e){window.gtag&&window.gtag("event",t,e),window.PerformanceMetrics&&window.PerformanceMetrics.recordABTestEvent(t,e),this.log(`AB Test Event: ${t}`,e),this.storeEventLocally(t,e)},storeEventLocally:function(t,e){try{const n=JSON.parse(localStorage.getItem("ab_test_events")||"[]");n.push({event:t,data:e,timestamp:(new Date).toISOString()}),n.length>1e3&&n.splice(0,n.length-1e3),localStorage.setItem("ab_test_events",JSON.stringify(n))}catch(t){this.log("Error storing event:",t)}},getResults:function(t){const e=JSON.parse(localStorage.getItem("ab_test_events")||"[]"),n=this.experiments[t];if(!n)return null;const s={experiment:n.name,variants:{}};return Object.keys(n.variants).forEach(t=>{s.variants[t]={views:0,goals:{}},n.goals.forEach(e=>{s.variants[t].goals[e]={count:0,data:[]}})}),e.forEach(e=>{if(e.data.experiment_id!==t)return;const n=e.data.variant;if(s.variants[n])if("experiment_view"===e.event)s.variants[n].views++;else if("goal_achieved"===e.event){const t=e.data.goal;s.variants[n].goals[t]&&(s.variants[n].goals[t].count++,s.variants[n].goals[t].data.push(e.data.data))}}),Object.keys(s.variants).forEach(t=>{const e=s.variants[t];Object.keys(e.goals).forEach(t=>{const n=e.goals[t];n.conversionRate=e.views>0?n.count/e.views*100:0})}),s},getAllResults:function(){const t={};return Object.keys(this.experiments).forEach(e=>{t[e]=this.getResults(e)}),t},exportResults:function(){const t=this.getAllResults(),e=JSON.stringify(t,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(e),s="ab-test-results-"+(new Date).toISOString().split("T")[0]+".json",a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",s),a.click()},setCookie:function(t,e,n){document.cookie=`${t}=${e}; expires=${n.toUTCString()}; path=/; SameSite=Lax`},getCookie:function(t){const e=`; ${document.cookie}`.split(`; ${t}=`);return 2===e.length?e.pop().split(";").shift():null},log:function(...t){this.config.enableLogging&&console.log("[AB Testing]",...t)},getVariant:function(t){const e=this.experiments[t];return e?e.userVariant:null},isInVariant:function(t,e){return this.getVariant(t)===e},forceVariant:function(t,e){const n=this.getUserAssignments();n[t]=e,this.saveUserAssignments(n),window.location.reload()},clearAssignments:function(){this.setCookie("ab_assignments","",new Date(0)),localStorage.removeItem("ab_test_events"),window.location.reload()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.init()}):t.init(),window.ABTesting=t}();